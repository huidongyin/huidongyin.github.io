(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{550:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-使用docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用docker安装"}},[s._v("#")]),s._v(" 1.使用docker安装")]),s._v(" "),a("h3",{attrs:{id:"_1-1-docker安装elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-docker安装elasticsearch"}},[s._v("#")]),s._v(" 1.1 docker安装ElasticSearch")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull elasticsearch:7.7.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("启动镜像")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" elasticsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ES_JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms512m -Xmx512m"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always elasticsearch:7.7.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker run")]),s._v(": 用于在 Docker 上运行一个新的容器。")]),s._v(" "),a("li",[a("code",[s._v("--name elasticsearch")]),s._v(': 为容器指定一个名称，这里为 "elasticsearch"。')]),s._v(" "),a("li",[a("code",[s._v("-d")]),s._v(": 以后台（守护进程）模式运行容器。")]),s._v(" "),a("li",[a("code",[s._v('-e ES_JAVA_OPTS="-Xms512m -Xmx512m"')]),s._v(": 设置 Elasticsearch 的 Java 虚拟机参数。"),a("code",[s._v("-Xms")]),s._v("\n表示初始堆内存大小，这里设置为512MB；"),a("code",[s._v("-Xmx")]),s._v(" 表示最大堆内存大小，也设置为 512MB。")]),s._v(" "),a("li",[a("code",[s._v('-e "discovery.type=single-node"')]),s._v(': 设置 Elasticsearch 的集群发现类型为 "single-node"\n，这将使Elasticsearch运行在单节点模式，适用于开发和测试。')]),s._v(" "),a("li",[a("code",[s._v("-p 9200:9200 -p 9300:9300")]),s._v(": 映射容器的端口到主机的端口，将 Elasticsearch 的 HTTP 端口（9200）和节点间通信端口（9300）分别映射到主机的相应端口。")]),s._v(" "),a("li",[a("code",[s._v("--restart=always")]),s._v(": 设置容器自动重启，以保证 Elasticsearch 容器在系统重启后自动运行。")]),s._v(" "),a("li",[a("code",[s._v("elasticsearch:7.7.0")]),s._v(": 指定要运行的容器镜像，这里是 Elasticsearch 7.7.0 版本。")])]),s._v(" "),a("p",[s._v("这个命令将启动一个单节点的 Elasticsearch\n容器，限制了堆内存大小，设置了自动重启，并将容器的端口映射到主机的端口，以便通过主机访问Elasticsearch服务。请注意，这里使用的是单节点模式，适用于本地开发和测试环境。在生产环境中，您可能需要更复杂的集群配置。")]),s._v(" "),a("p",[a("code",[s._v("discovery.type")]),s._v("\n是Elasticsearch中用于配置集群发现类型的设置，它决定了如何发现集群中的其他节点。以下是可选的 "),a("code",[s._v("discovery.type")]),s._v(" 值：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("single-node")]),s._v(": 这是单节点模式，适用于开发和测试环境。在这种模式下，Elasticsearch 将运行为单独的节点，不会尝试发现其他节点，也不会组成集群。")]),s._v(" "),a("li",[a("code",[s._v("zen")]),s._v(": 这是默认的集群发现类型，适用于生产环境中的多节点集群。它使用 Zen Discovery 机制来发现和加入其他节点，可以在不同主机上的节点之间构建集群。")]),s._v(" "),a("li",[a("code",[s._v("local")]),s._v(": 这个模式用于在本地运行多个节点的单节点集群。每个节点都是一个独立的集群，不会连接到其他节点。")]),s._v(" "),a("li",[a("code",[s._v("ec2")]),s._v(": 用于在亚马逊 AWS 环境中发现其他节点。它会利用 AWS 的元数据服务来发现节点。")]),s._v(" "),a("li",[a("code",[s._v("gce")]),s._v(": 用于在 Google Cloud Environment（GCE）中发现其他节点。")]),s._v(" "),a("li",[a("code",[s._v("k8s")]),s._v(": 用于在 Kubernetes 环境中发现其他节点。")])]),s._v(" "),a("p",[s._v("这些不同的发现类型适用于不同的部署环境和需求，您可以根据您的场景选择适合的发现类型。在实际配置中，您可以通过在\nElasticsearch 的配置文件中设置 "),a("code",[s._v("discovery.type")]),s._v(" 参数来选择合适的发现类型。")]),s._v(" "),a("p",[s._v("访问访问"),a("code",[s._v("localhost:9200")]),s._v(" 出现以下内容表示安装成功。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ece13c2201ae"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-cluster"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_uuid"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PyT_-BOASeCwRolhP3I39A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.7.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_flavor"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_hash"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"81a1e9eda8e6183f5237786246f6dced26a10eaf"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_date"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-05-12T02:01:37.602180Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_snapshot"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lucene_version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.5.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum_wire_compatibility_version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.8.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum_index_compatibility_version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.0.0-beta1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tagline"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"You Know, for Search"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_1-2-安装es-header插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装es-header插件"}},[s._v("#")]),s._v(" 1.2 安装es-header插件")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull mobz/elasticsearch-head:5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" elasticsearch-head "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),s._v(":9100 mobz/elasticsearch-head:5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("启动容器")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" start elasticsearch-head\nor\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" start 容器id （docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" 查看容器id ）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("访问localhost:9100 出现插件管理控制台 说明安装成功。")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。")]),s._v(" "),a("p",[s._v("解决办法：修改docker中elasticsearch的elasticsearch.yml文件。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" elasticsearch /bin/bash （进不去使用容器id进入）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",[a("li",[s._v("在Es容器内操作")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" config/elasticsearch.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在最下面添加2行")]),s._v("\nhttp.cors.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \nhttp.cors.allow-origin: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 退出并重启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("退出Es容器后执行")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart 容器id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("bug修复：ElasticSearch-head 操作时不修改配置，默认会报 406错误码。")])]),s._v(" "),a("ol",[a("li",[s._v("进入es-haed 插件容器")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" elasticsearch-head /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在容器内操作")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 编辑他的前端交互js文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/src/app/_site/vendor.js\n\n第6886行：把 application/x-www-form-urlencoded 改成 application/json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-8\n\n第7574行：把 application/x-www-form-urlencoded 改成 application/json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-8\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保存退出，重启容器，成功查询到es数据")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_1-3-安装ik分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-安装ik分词器"}},[s._v("#")]),s._v(" 1.3 安装IK分词器")]),s._v(" "),a("ol",[a("li",[s._v("进入Es容器")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" elasticsearch /bin/bash （进不去使用容器id进入）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("容器内操作")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/elasticsearch/plugins\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ik\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ik \n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" elasticsearch-analysis-ik-7.7.0.zip\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除压缩包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" elasticsearch-analysis-ik-7.7.0.zip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("完成后退出容器并重启。")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_1-4-安装kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-安装kibana"}},[s._v("#")]),s._v(" 1.4 安装Kibana")]),s._v(" "),a("ol",[a("li",[s._v("拉镜像")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull kibana:7.7.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在服务器/物理机上创建本地目录文件")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /es/kibana\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /es/kibana\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kibana.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#加入以下内容：")]),s._v("\n\nserver.host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ip为es的docker容器ip")]),s._v("\nelasticsearch.hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://172.17.0.5:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nxpack.monitoring.ui.container.elasticsearch.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ni18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 保存退出")]),s._v("\n:wq"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("以下是每个配置的含义：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v('server.host: "0.0.0.0"')]),s._v('：这个配置指定了 Kibana 服务绑定的主机地址。"0.0.0.0" 表示\nKibana会监听所有可用的网络接口，从而允许来自任何地址的连接。这是通常用于让Kibana 可以通过外部网络访问，比如通过浏览器访问Kibana\n的 Web 界面。')]),s._v(" "),a("li",[a("code",[s._v('elasticsearch.hosts: ["http://172.17.0.5:9200"]')]),s._v("：这个配置指定了 Kibana 连接到的 Elasticsearch\n节点的主机地址。"),a("code",[s._v("elasticsearch.hosts")]),s._v(' 参数设置一个数组，里面包含一个或多个Elasticsearch 节点的地址。在这个例子中，Kibana将连接到一个\nElasticsearch 节点，该节点的地址是 "http://172.17.0.5:9200"。')]),s._v(" "),a("li",[a("code",[s._v("xpack.monitoring.ui.container.elasticsearch.enabled: true")]),s._v("：这个配置启用了容器化环境下的 Elasticsearch 监控特性。当\nKibana 在容器中运行时，它可以通过这个配置来启用与 Elasticsearch的监控交互，以获取有关集群健康和性能的信息。")]),s._v(" "),a("li",[a("code",[s._v('i18n.locale: "zh-CN"')]),s._v('：这个配置设置 Kibana 的界面语言。在这个例子中，界面语言被设置为中文（简体），对应的语言代码是 "\nzh-CN"。这将影响 Kibana界面的显示语言。')])]),s._v(" "),a("p",[s._v("总之，这些配置项允许您定制 Kibana 的网络绑定、Elasticsearch 连接、容器环境监控以及界面语言设置，以适应您的部署和使用需求。")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("启动容器")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" kibana "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /es/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always kibana:7.7.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",[a("li",[a("code",[s._v("--name kibana")]),s._v('：这个参数指定了容器的名称，将容器命名为 "kibana"，以便于后续引用和管理容器。')]),s._v(" "),a("li",[a("code",[s._v("-v /es/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml")]),s._v("：这个参数通过 "),a("code",[s._v("-v")]),s._v(" 选项将主机的 Kibana\n配置文件挂载到容器中。左边的路径 "),a("code",[s._v("/es/kibana/kibana.yml")]),s._v("\n是主机上的配置文件路径，右边的路径 "),a("code",[s._v("/usr/share/kibana/config/kibana.yml")]),s._v(" 是容器中的配置文件路径。这样做可以让您在容器外部编辑配置文件，从而定制Kibana\n的设置。")]),s._v(" "),a("li",[a("code",[s._v("-p 5601:5601")]),s._v("：这个参数使用 "),a("code",[s._v("-p")]),s._v(" 选项将容器的端口映射到主机的端口。左边的端口号 "),a("code",[s._v("5601")]),s._v(" 是容器内的\nKibana服务端口，右边的端口号 "),a("code",[s._v("5601")]),s._v("是主机上的端口，将被用于访问 Kibana 的 Web 界面。")]),s._v(" "),a("li",[a("code",[s._v("-d")]),s._v("：这个参数表示以后台（守护进程）模式运行容器，即在后台运行容器，并返回命令行提示符。")]),s._v(" "),a("li",[a("code",[s._v("--restart=always")]),s._v("：这个参数指定了容器在异常退出时的重启策略。"),a("code",[s._v("always")]),s._v(" 表示容器总是在退出后自动重启。")]),s._v(" "),a("li",[a("code",[s._v("kibana:7.7.0")]),s._v("：这是容器的镜像名称和版本号。"),a("code",[s._v("kibana")]),s._v(" 是镜像名称，"),a("code",[s._v("7.7.0")]),s._v(" 是版本号。这个参数指定了使用哪个 Kibana 镜像来运行容器。")])]),s._v(" "),a("blockquote",[a("p",[s._v("有可能kibana连接不上es，几个注意点：")]),s._v(" "),a("ol",[a("li",[s._v("保证Es和Kibana在同一个网段。")]),s._v(" "),a("li",[s._v("或者使用桥接的方式连接二者")]),s._v(" "),a("li",[s._v("注意版本对应")]),s._v(" "),a("li",[s._v("注意配置文件的冒号后面有空格")])])]),s._v(" "),a("blockquote",[a("p",[s._v("可能请求之后发现跨域，这个直接根据浏览器F12提示找到对应的源码，改一下就行了。\n我的Mac是M1芯片的，安装的Es版本是7.16.2，其他的Follow上面即可。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_2-linux物理机安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-linux物理机安装"}},[s._v("#")]),s._v(" 2. Linux物理机安装")]),s._v(" "),a("h3",{attrs:{id:"_2-1-单机安装es"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-单机安装es"}},[s._v("#")]),s._v(" 2.1 单机安装Es")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-8-0",target:"_blank",rel:"noopener noreferrer"}},[s._v("软件包下载地址"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[s._v("解压软件")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 解压缩")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" elasticsearch-7.8.0-linux-x86_64.tar.gz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" /opt/module\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 改名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" elasticsearch-7.8.0 es\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("解压后可以看到 ES 的文件目录结构如下：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("目录")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("bin")]),s._v(" "),a("td",[s._v("包含一些执行脚本，其中ES的启动文件和脚本安装文件就在这里")])]),s._v(" "),a("tr",[a("td",[s._v("config")]),s._v(" "),a("td",[s._v("包含集群的配置文件(elasticsearch.yml),jvm配置文件(jvm.options),user等相关配置")])]),s._v(" "),a("tr",[a("td",[s._v("JDK")]),s._v(" "),a("td",[s._v("ES7.0版本以后默认带有JDK")])]),s._v(" "),a("tr",[a("td",[s._v("lib")]),s._v(" "),a("td",[s._v("java的一些类库")])]),s._v(" "),a("tr",[a("td",[s._v("plugins")]),s._v(" "),a("td",[s._v("ES插件的安装目录")])]),s._v(" "),a("tr",[a("td",[s._v("modules")]),s._v(" "),a("td",[s._v("包含所有的ES模块")])])])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建用户")])]),s._v(" "),a("blockquote",[a("p",[s._v("因为安全问题,Elasticsearch 不允许 root 用户直接运行,所以要创建新用户,在 root中创建新用户。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" es "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新增 es 用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" es "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#为 es 用户设置密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("userdel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" es "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果错了,可以删除再加")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" es:es /opt/module/es "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件夹所有者")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("修改配置文件")])]),s._v(" "),a("blockquote",[a("p",[s._v("修改"),a("code",[s._v("/opt/module/es/config/elasticsearch.yml")]),s._v("文件")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 加入如下配置")]),s._v("\ncluster.name: elasticsearch\nnode.name: node-1\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npath.data: ./data\npath.logs: ./logs\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("discovery.seed_hosts")]),s._v(":默认本机的情况下无需扫描，Es会默认的扫描本机的9300-9305端口，一旦进行了网络环境配置，这个默认扫描就会失效。\n"),a("strong",[s._v("discovery.seed_hosts 配置为 master 候选者节点即可。")]),s._v("\n如果需要指定端口的话，其值可以为："),a("code",[s._v('["localhost:9300", "localhost:9301"]')]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("cluster.initial_master_nodes")]),s._v('指定新集群 master 候选者列表，其值为节点的名字列表。这里配置了node.name:\nnode-1，所以其值为 ["node-1"]，而不是 ip 列表 ！')]),s._v(" "),a("li",[a("strong",[s._v("network.host 和 http.port")]),s._v("是 ES 提供服务的监听地址和端口，"),a("strong",[s._v("线上一定不能配置 ip 为 0.0.0.0，这是非常危险的行为")]),s._v("！！！")])]),s._v(" "),a("p",[s._v("怎么样来理解这个 "),a("code",[s._v("discovery.seed_hosts")]),s._v(" 和 "),a("code",[s._v("cluster.initial_master_nodes")]),s._v(" 呢？")]),s._v(" "),a("p",[a("code",[s._v("cluster.initial_master_nodes")]),s._v("\n是候选者列表，一般我们线上环境候选者的数量会比较少，毕竟是用来做备用的。而且这个配置只跟选举master有关，也就是跟其他类型的节点没有关系，其他类型的节点不需要配置这个也是可以的。")]),s._v(" "),a("p",[a("code",[s._v("discovery.seed_hosts")]),s._v(" 这个可以理解为是做服务或者节点发现的，其他节点必须知道他们才能进入集群，一般配置为集群的\nmaster候选者的列表。")]),s._v(" "),a("p",[s._v("在现实环境中是这些 master 候选者（组织联系人）可能会经常变化，那怎么办呢？"),a("code",[s._v("discovery.seed_hosts")]),s._v("\n这个配置项除了支持ip外还支持域名，所以可以用域名来解决这个问题。其他类型节点的配置上写的是域名，域名解析到对应的\nip，如果机器挂了，新的节点ip换了，就把域名解析到新的ip即可，这样其他节点的配置就不用修改了。所以非 master\n候选节点要配 "),a("code",[s._v("discovery.seed_hosts")]),s._v("\n（组织联系人）才能顺利加入到集群中来。")]),s._v(" "),a("blockquote",[a("p",[s._v("修改"),a("code",[s._v("/opt/module/es/config/jvm.options")]),s._v("文件")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置堆内存最小值 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms1g")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置堆内存最大值 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx1g")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("JVM 配置需要以下几点：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("-Xms 和-Xmx 这两个 JVM 的参数必须配置为一样的数值")]),s._v("。服务在启动的时候就分配好内存空间，避免运行时申请分配内存造成系统抖动。")]),s._v(" "),a("li",[a("strong",[s._v("Xmx 不要超过机器内存的 50%，留下些内存供 JVM 堆外内存使用")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("并且 Xmx 不要超过 32G")]),s._v("。"),a("strong",[s._v("建议最大配置为 30G")]),s._v("。接近 32G，可能会导致 JVM 压缩指针的功能失效，导致性能下降。")])]),s._v(" "),a("blockquote",[a("p",[s._v("修改"),a("code",[s._v("/etc/security/limits.conf")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在文件末尾中增加下面内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 每个进程可以打开的文件数的限制")]),s._v("\nes soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\nes hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("修改"),a("code",[s._v("/etc/security/limits.d/20-nproc.conf")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在文件末尾中增加下面内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 每个进程可以打开的文件数的限制")]),s._v("\nes soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\nes hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 操作系统级别对每个用户创建的进程数的限制")]),s._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 注:* 代表 Linux 所有用户名称")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("修改"),a("code",[s._v("/etc/sysctl.conf")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在文件中增加下面内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 一个进程可以拥有的 VMA(虚拟内存区域)的数量,默认值为 65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("重新加载")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("使用 ES 用户启动")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/es/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动")]),s._v("\nbin/elasticsearch\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后台启动")]),s._v("\nbin/elasticsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看日志：elasticsearch 指定的配置文件配置的cluster.name")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" logs/elasticsearch.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("启动时,会动态生成文件,如果文件所属用户不匹配,会发生错误,需要重新进行修改用户和用户组。")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_2-2-集群安装es"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-集群安装es"}},[s._v("#")]),s._v(" 2.2 集群安装Es")]),s._v(" "),a("blockquote",[a("p",[s._v("修改 "),a("code",[s._v("/opt/module/es/config/elasticsearch.yml")]),s._v(" 文件,分发文件.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 加入如下配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#集群名称")]),s._v("\ncluster.name: cluster-es\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#节点名称,每个节点的名称不能重复")]),s._v("\nnode.name: node-1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip 地址,每个节点的地址不能重复")]),s._v("\nnetwork.host: linux1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是不是有资格主节点")]),s._v("\nnode.master: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nnode.data: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## head 插件需要这打开这两个配置")]),s._v("\nhttp.cors.allow-origin: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\nhttp.cors.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.max_content_length: 200mb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#es7.x 之后新增的配置,初始化一个新的集群时需要此配置来选举 master")]),s._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#es7.x 之后新增的配置,节点发现")]),s._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux1:9300"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux2:9300"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux3:9300"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ngateway.recover_after_nodes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nnetwork.tcp.keep_alive: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nnetwork.tcp.no_delay: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ntransport.tcp.compress: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#集群内同时启动的数据任务个数,默认是 2 个")]),s._v("\ncluster.routing.allocation.cluster_concurrent_rebalance: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加或删除节点及负载均衡时并发恢复的线程个数,默认 4 个")]),s._v("\ncluster.routing.allocation.node_concurrent_recoveries: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化数据恢复时,并发恢复线程的个数,默认 4 个")]),s._v("\ncluster.routing.allocation.node_initial_primaries_recoveries: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("blockquote",[a("p",[s._v("其余修改同单机安装。")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_2-3-安装kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装kibana"}},[s._v("#")]),s._v(" 2.3 安装Kibana")]),s._v(" "),a("p",[s._v("Kibana 与 ES 的版本是有对应关系的，所以需要下载与 ES 同版本的\nKibana，在这里下载"),a("a",{attrs:{href:"https://artifacts.elastic.co/downloads/kibana/kibana-7.8.0-linux-x86_64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kibana 7.8.0"),a("OutboundLink")],1),s._v("。\n使用 wget 下载并且解压安装 Kibana：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 进入刚才安装ES的目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ES\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://artifacts.elastic.co/downloads/kibana/kibana-7.8.0-linux-x86_64.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvf kibana-7.8.0-linux-x86_64.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重命名")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" kibana-7.8.0-linux-x86_64 kibana\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kibana\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 需要注意的是，线上一定不能配置ip为 0.0.0.0，这是非常危险的行为！！！")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\nserver.host: \"0.0.0.0\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" config/kibana.yml\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\nelasticsearch.hosts: [\"http://localhost:9211\"]'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" config/kibana.yml\n\n./bin/kibana "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" run.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("安装完成后，在浏览器中访问 localhost:5601，如果运行成功可以进入到如下界面：\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/huidongyin/DrawingBed/main/elasticsearch/202311042019439.png",alt:""}})]),s._v(" "),a("hr")])}),[],!1,null,null,null);a.default=n.exports}}]);