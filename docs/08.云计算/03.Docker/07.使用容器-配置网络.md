---
title: ä½¿ç”¨å®¹å™¨-é…ç½®ç½‘ç»œ
date: 2024-01-09 00:00:00
tags:
    - Docker
    - äº‘è®¡ç®—
categories:
    - Docker
description: ä½¿ç”¨å®¹å™¨-é…ç½®ç½‘ç»œ
toc_number: false
author:
    name: huidong.yin
    link: https://huidongyin.github.io
permalink: /pages/0bd962fb-3c61-3582-a39f-f5aa78aaf6df/

---

Docker ä½œä¸ºé›†ç¾¤éƒ¨ç½²çš„åˆ©å™¨ï¼Œåœ¨ç½‘ç»œæ”¯æŒä¸Šä¹Ÿä¸‹äº†è®¸å¤šåŠŸå¤«ã€‚åŠŸèƒ½ä¸°å¯Œå’Œå¼ºå¤§ï¼Œå¹¶ä¸ä»£è¡¨ä½¿ç”¨å¤æ‚ï¼Œåœ¨ Docker çš„å°è£…ä¸‹ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡å‘½ä»¤å’Œå‚æ•°è½»æ¾çš„ä¸ºå®¹å™¨åˆ¶å®šä¸åŒçš„ç½‘ç»œæ–¹æ¡ˆã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°±æ¥äº†è§£ Docker çš„ç½‘ç»œéƒ¨åˆ†ã€‚

---

## 1.å®¹å™¨ç½‘ç»œ

åœ¨ä¹‹å‰ä»‹ç» Docker æ ¸å¿ƒç»„æˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»ç®€å•è°ˆåˆ°äº†å®¹å™¨ç½‘ç»œçš„ç›¸å…³çŸ¥è¯†ã€‚å®¹å™¨ç½‘ç»œå®è´¨ä¸Šä¹Ÿæ˜¯ç”± Docker ä¸ºåº”ç”¨ç¨‹åºæ‰€åˆ›é€ çš„è™šæ‹Ÿç¯å¢ƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒèƒ½è®©åº”ç”¨ä»å®¿ä¸»æœºæ“ä½œç³»ç»Ÿçš„ç½‘ç»œç¯å¢ƒä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œå½¢æˆå®¹å™¨è‡ªæœ‰çš„ç½‘ç»œè®¾å¤‡ã€IP åè®®æ ˆã€ç«¯å£å¥—æ¥å­—ã€IP è·¯ç”±è¡¨ã€é˜²ç«å¢™ç­‰ç­‰ä¸ç½‘ç»œç›¸å…³çš„æ¨¡å—ã€‚

![](https://raw.githubusercontent.com/huidongyin/DrawingBed/main/Docker/202401092119814.webp)

è¿˜æ˜¯å›å½’ä¸Šé¢è¿™å¹…ä¹‹å‰å±•ç¤ºè¿‡çš„å…³äº Docker ç½‘ç»œçš„å›¾ç‰‡ã€‚åœ¨ Docker ç½‘ç»œä¸­ï¼Œæœ‰ä¸‰ä¸ªæ¯”è¾ƒæ ¸å¿ƒçš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ï¼š**æ²™ç›’** ( Sandbox )ã€**ç½‘ç»œ** ( Network )ã€**ç«¯ç‚¹** ( Endpoint )ã€‚

- **æ²™ç›’**æä¾›äº†å®¹å™¨çš„è™šæ‹Ÿç½‘ç»œæ ˆï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰æ‰€æåˆ°çš„ç«¯å£å¥—æ¥å­—ã€IP è·¯ç”±è¡¨ã€é˜²ç«å¢™ç­‰çš„å†…å®¹ã€‚å…¶å®ç°éš”ç¦»äº†å®¹å™¨ç½‘ç»œä¸å®¿ä¸»æœºç½‘ç»œï¼Œå½¢æˆäº†å®Œå…¨ç‹¬ç«‹çš„å®¹å™¨ç½‘ç»œç¯å¢ƒã€‚
- **ç½‘ç»œ**å¯ä»¥ç†è§£ä¸º Docker å†…éƒ¨çš„è™šæ‹Ÿå­ç½‘ï¼Œç½‘ç»œå†…çš„å‚ä¸è€…ç›¸äº’å¯è§å¹¶èƒ½å¤Ÿè¿›è¡Œé€šè®¯ã€‚Docker çš„è¿™ç§è™šæ‹Ÿç½‘ç»œä¹Ÿæ˜¯äºå®¿ä¸»æœºç½‘ç»œå­˜åœ¨éš”ç¦»å…³ç³»çš„ï¼Œå…¶ç›®çš„ä¸»è¦æ˜¯å½¢æˆå®¹å™¨é—´çš„å®‰å…¨é€šè®¯ç¯å¢ƒã€‚
- **ç«¯ç‚¹**æ˜¯ä½äºå®¹å™¨æˆ–ç½‘ç»œéš”ç¦»å¢™ä¹‹ä¸Šçš„æ´ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å½¢æˆä¸€ä¸ªå¯ä»¥æ§åˆ¶çš„çªç ´å°é—­çš„ç½‘ç»œç¯å¢ƒçš„å‡ºå…¥å£ã€‚å½“å®¹å™¨çš„ç«¯ç‚¹ä¸ç½‘ç»œçš„ç«¯ç‚¹å½¢æˆé…å¯¹åï¼Œå°±å¦‚åŒåœ¨è¿™ä¸¤è€…ä¹‹é—´æ­å»ºäº†æ¡¥æ¢ï¼Œä¾¿èƒ½å¤Ÿè¿›è¡Œæ•°æ®ä¼ è¾“äº†ã€‚

è¿™ä¸‰è€…å½¢æˆäº† Docker ç½‘ç»œçš„æ ¸å¿ƒæ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯**å®¹å™¨ç½‘ç»œæ¨¡å‹** ( Container Network Model )ã€‚

å®¹å™¨ç½‘ç»œæ¨¡å‹ä¸ºå®¹å™¨å¼•æ“æä¾›äº†ä¸€å¥—æ ‡å‡†çš„ç½‘ç»œå¯¹æ¥èŒƒå¼ï¼Œè€Œåœ¨ Docker ä¸­ï¼Œå®ç°è¿™å¥—èŒƒå¼çš„æ˜¯ Docker æ‰€å°è£…çš„ `libnetwork` æ¨¡å—ã€‚

è€Œå¯¹äºç½‘ç»œçš„å…·ä½“å®ç°ï¼Œåœ¨ Docker çš„å‘å±•è¿‡ç¨‹ä¸­ä¹Ÿé€æ¸æŠ½è±¡ï¼Œå½¢æˆäº†ç»Ÿä¸€çš„æŠ½è±¡å®šä¹‰ã€‚è¿›è€Œé€šè¿‡è¿™äº›æŠ½è±¡å®šä¹‰ï¼Œä¾¿å¯ä»¥å¯¹ Docker ç½‘ç»œçš„å®ç°æ–¹å¼è¿›è¡Œä¸åŒçš„å˜åŒ–ã€‚

![](https://raw.githubusercontent.com/huidongyin/DrawingBed/main/Docker/202401092120009.webp)

ç›®å‰ Docker å®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†äº”ç§ Docker ç½‘ç»œé©±åŠ¨ï¼Œåˆ†åˆ«æ˜¯ï¼š**Bridge Driver**ã€**Host Driver**ã€**Overlay Driver**ã€**MacLan Driver**ã€**None Driver**ã€‚

å…¶ä¸­ï¼ŒBridge ç½‘ç»œæ˜¯ Docker å®¹å™¨çš„é»˜è®¤ç½‘ç»œé©±åŠ¨ï¼Œç®€è€Œè¨€ä¹‹å…¶å°±æ˜¯é€šè¿‡ç½‘æ¡¥æ¥å®ç°ç½‘ç»œé€šè®¯ ( ç½‘æ¡¥ç½‘ç»œçš„å®ç°å¯ä»¥åŸºäºç¡¬ä»¶ï¼Œä¹Ÿå¯ä»¥åŸºäºè½¯ä»¶ )ã€‚è€Œ Overlay ç½‘ç»œæ˜¯å€ŸåŠ© Docker é›†ç¾¤æ¨¡å— Docker Swarm æ¥æ­å»ºçš„è·¨ Docker Daemon ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ­å»ºè·¨ç‰©ç†ä¸»æœºçš„è™šæ‹Ÿç½‘ç»œï¼Œè¿›è€Œè®©ä¸åŒç‰©ç†æœºä¸­è¿è¡Œçš„å®¹å™¨æ„ŸçŸ¥ä¸åˆ°å¤šä¸ªç‰©ç†æœºçš„å­˜åœ¨ã€‚

---

### 1.1 Bridgeç½‘ç»œåè®®

åœ¨è¯¥æ¨¡å¼ä¸­ï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿä»¥å¤ªç½‘æ¡¥ `docker0`ï¼Œæ–°å»ºçš„å®¹å™¨ä¼šè‡ªåŠ¨æ¡¥æ¥åˆ°è¿™ä¸ªæ¥å£ï¼Œé™„åŠ åœ¨å…¶ä¸Šçš„ä»»ä½•ç½‘å¡ä¹‹é—´éƒ½èƒ½è‡ªåŠ¨è½¬å‘æ•°æ®åŒ…ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ˆæŠ¤è¿›ç¨‹ä¼šåˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿè®¾å¤‡æ¥å£ `veth pair`ï¼Œå°†å…¶ä¸­ä¸€ä¸ªæ¥å£è®¾ç½®ä¸ºå®¹å™¨çš„ `eth0` æ¥å£ï¼ˆå®¹å™¨çš„ç½‘å¡ï¼‰ï¼Œå¦ä¸€ä¸ªæ¥å£æ”¾ç½®åœ¨å®¿ä¸»æœºçš„å‘½åç©ºé—´ä¸­ï¼Œä»¥ç±»ä¼¼ `vethxxx` è¿™æ ·çš„åå­—å‘½åï¼Œä»è€Œå°†å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ°è¿™ä¸ªå†…éƒ¨ç½‘ç»œä¸Šã€‚

åŒæ—¶ï¼Œå®ˆæŠ¤è¿›ç¨‹è¿˜ä¼šä»ç½‘æ¡¥ `docker0` çš„ç§æœ‰åœ°å€ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ª IP åœ°å€å’Œå­ç½‘ç»™è¯¥å®¹å™¨ï¼Œå¹¶è®¾ç½® `docker0` çš„ IP åœ°å€ä¸ºå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚

å…³äº bridge ç½‘ç»œæ¨¡å¼çš„ä½¿ç”¨ï¼Œåªéœ€è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶é€šè¿‡å‚æ•° `--net bridge` æˆ–è€… `--network bridge` æŒ‡å®šå³å¯ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯åˆ›å»ºå®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‚æ•°æ˜¯å¯ä»¥çœç•¥çš„ã€‚

![](https://raw.githubusercontent.com/huidongyin/DrawingBed/main/Docker/202401092120889.png)

Bridge æ¡¥æ¥æ¨¡å¼çš„å®ç°æ­¥éª¤ä¸»è¦å¦‚ä¸‹ï¼š

- Docker Daemon åˆ©ç”¨ `veth pair` æŠ€æœ¯ï¼Œåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿç½‘ç»œæ¥å£è®¾å¤‡ï¼Œå‡è®¾ä¸º `veth0` å’Œ `veth1`ã€‚è€Œ `veth pair` æŠ€æœ¯çš„ç‰¹æ€§å¯ä»¥ä¿è¯æ— è®ºå“ªä¸€ä¸ª `veth` æ¥æ”¶åˆ°ç½‘ç»œæŠ¥æ–‡ï¼Œéƒ½ä¼šå°†æŠ¥æ–‡ä¼ è¾“ç»™å¦ä¸€æ–¹ã€‚
- Docker Daemon å°† `veth0` é™„åŠ åˆ° Docker Daemon åˆ›å»ºçš„ `docker0` ç½‘æ¡¥ä¸Šã€‚ä¿è¯å®¿ä¸»æœºçš„ç½‘ç»œæŠ¥æ–‡å¯ä»¥å‘å¾€ veth0ï¼›
- Docker Daemon å°† `veth1` æ·»åŠ åˆ° Docker Container æ‰€å±çš„ `namespace` ä¸‹ï¼Œå¹¶è¢«æ”¹åä¸º  `eth0`ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå®¿ä¸»æœºçš„ç½‘ç»œæŠ¥æ–‡è‹¥å‘å¾€ `veth0`ï¼Œåˆ™ç«‹å³ä¼šè¢« Container çš„ `eth0` æ¥æ”¶ï¼Œå®ç°å®¿ä¸»æœºåˆ° Docker  Container ç½‘ç»œçš„è”é€šæ€§ï¼›åŒæ—¶ï¼Œä¹Ÿä¿è¯ Docker Container å•ç‹¬ä½¿ç”¨ `eth0`ï¼Œå®ç°å®¹å™¨ç½‘ç»œç¯å¢ƒçš„éš”ç¦»æ€§ã€‚

---

### 1.2 Hostç½‘ç»œåè®®

- host ç½‘ç»œæ¨¡å¼éœ€è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶é€šè¿‡å‚æ•° `--net host` æˆ–è€… `--network host` æŒ‡å®šï¼›
- é‡‡ç”¨ host ç½‘ç»œæ¨¡å¼çš„ Docker Containerï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP åœ°å€ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œè‹¥å®¿ä¸»æœºçš„ `eth0` æ˜¯ä¸€ä¸ªå…¬æœ‰ IPï¼Œé‚£ä¹ˆå®¹å™¨ä¹Ÿæ‹¥æœ‰è¿™ä¸ªå…¬æœ‰ IPã€‚åŒæ—¶å®¹å™¨å†…æœåŠ¡çš„ç«¯å£ä¹Ÿå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„ç«¯å£ï¼Œæ— éœ€é¢å¤–è¿›è¡Œ NAT è½¬æ¢ï¼›
- host ç½‘ç»œæ¨¡å¼å¯ä»¥è®©å®¹å™¨å…±äº«å®¿ä¸»æœºç½‘ç»œæ ˆï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¤–éƒ¨ä¸»æœºä¸å®¹å™¨ç›´æ¥é€šä¿¡ï¼Œä½†æ˜¯å®¹å™¨çš„ç½‘ç»œç¼ºå°‘éš”ç¦»æ€§ã€‚

![](https://raw.githubusercontent.com/huidongyin/DrawingBed/main/Docker/202401092121126.png)


---

## 2.ç®¡ç†ç½‘ç»œ

å®¹å™¨èƒ½å¤Ÿäº’ç›¸è¿æ¥çš„å‰ææ˜¯ä¸¤è€…åŒå¤„äºä¸€ä¸ªç½‘ç»œä¸­ ( è¿™é‡Œçš„ç½‘ç»œæ˜¯æŒ‡å®¹å™¨ç½‘ç»œæ¨¡å‹ä¸­çš„ç½‘ç»œ )ã€‚è¿™ä¸ªé™åˆ¶å¾ˆå¥½ç†è§£ï¼Œç½‘ç»œè¿™ä¸ªæ¦‚å¿µæˆ‘ä»¬å¯ä»¥ç†è§£ä¸º Docker æ‰€è™šæ‹Ÿçš„å­ç½‘ï¼Œè€Œå®¹å™¨ç½‘ç»œæ²™ç›’å¯ä»¥çœ‹åšæ˜¯è™šæ‹Ÿçš„ä¸»æœºï¼Œåªæœ‰å½“å¤šä¸ªä¸»æœºåœ¨åŒä¸€å­ç½‘é‡Œæ—¶ï¼Œæ‰èƒ½äº’ç›¸çœ‹åˆ°å¹¶è¿›è¡Œç½‘ç»œæ•°æ®äº¤æ¢ã€‚

å½“æˆ‘ä»¬å¯åŠ¨ Docker æœåŠ¡æ—¶ï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ bridge ç½‘ç»œï¼Œè€Œæˆ‘ä»¬åˆ›å»ºçš„å®¹å™¨åœ¨ä¸ä¸“é—¨æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹éƒ½ä¼šè¿æ¥åˆ°è¿™ä¸ªç½‘ç»œä¸Šã€‚

æˆ‘ä»¬é€šè¿‡ `docker inspect` å‘½ä»¤æŸ¥çœ‹å®¹å™¨ï¼Œå¯ä»¥åœ¨ Network éƒ¨åˆ†çœ‹åˆ°å®¹å™¨ç½‘ç»œç›¸å…³çš„ä¿¡æ¯ã€‚

```bash
$ sudo docker inspect mysql
[
    {
// ......
        "NetworkSettings": {
// ......
            "Networks": {
                "bridge": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": null,
                    "NetworkID": "bc14eb1da66b67c7d155d6c78cb5389d4ffa6c719c8be3280628b7b54617441b",
                    "EndpointID": "1e201db6858341d326be4510971b2f81f0f85ebd09b9b168e1df61bab18a6f22",
                    "Gateway": "172.17.0.1",
                    "IPAddress": "172.17.0.2",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:11:00:02",
                    "DriverOpts": null
                }
            }
// ......
        }
// ......
    }
]
```

è¿™é‡Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ° mysql å®¹å™¨åœ¨ bridge ç½‘ç»œä¸­æ‰€åˆ†é…çš„ IP åœ°å€ï¼Œå…¶è‡ªèº«çš„ç«¯ç‚¹ã€Mac åœ°å€ï¼Œbridge ç½‘ç»œçš„ç½‘å…³åœ°å€ç­‰ä¿¡æ¯ã€‚

Docker é»˜è®¤åˆ›å»ºçš„è¿™ä¸ª bridge ç½‘ç»œæ˜¯éå¸¸é‡è¦çš„ï¼Œç†ç”±è‡ªç„¶æ˜¯åœ¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šå®¹å™¨ç½‘ç»œæ—¶ï¼Œå®¹å™¨éƒ½ä¼šè¿æ¥åˆ°è¿™ä¸ªç½‘ç»œä¸­ã€‚

---

### 2.1 åˆ›å»ºç½‘ç»œ

åœ¨ Docker é‡Œï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿåˆ›å»ºç½‘ç»œï¼Œå½¢æˆè‡ªå®šä¹‰è™šæ‹Ÿå­ç½‘çš„ç›®çš„ã€‚

docker CLI é‡Œä¸ç½‘ç»œç›¸å…³çš„å‘½ä»¤éƒ½ä»¥ `docker network` å¼€å¤´ï¼Œå…¶ä¸­åˆ›å»ºç½‘ç»œçš„å‘½ä»¤æ˜¯ `docker network create`ã€‚

```bash
$ sudo docker network create -d bridge individual
```

é€šè¿‡ `-d` é€‰é¡¹æˆ‘ä»¬å¯ä»¥ä¸ºæ–°çš„ç½‘ç»œæŒ‡å®šé©±åŠ¨çš„ç±»å‹ï¼Œå…¶å€¼å¯ä»¥æ˜¯åˆšæ‰æˆ‘ä»¬æ‰€æåŠçš„ bridgeã€hostã€overlayã€maclanã€noneï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç½‘ç»œé©±åŠ¨æ’ä»¶æ‰€å®šä¹‰çš„ç±»å‹ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Bridge Driver ( å½“æˆ‘ä»¬ä¸æŒ‡å®šç½‘ç»œé©±åŠ¨æ—¶ï¼ŒDocker ä¹Ÿä¼šé»˜è®¤é‡‡ç”¨ Bridge Driver ä½œä¸ºç½‘ç»œé©±åŠ¨ )ã€‚

é€šè¿‡ `docker network ls` æˆ–æ˜¯ `docker network list` å¯ä»¥æŸ¥çœ‹ Docker ä¸­å·²ç»å­˜åœ¨çš„ç½‘ç»œã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 13:39:30
$ docker network ls
NETWORK ID     NAME            DRIVER    SCOPE
11521c5ba021   bridge          bridge    local
a95864f891d5   host            host      local
785cbdaeb8f4   kafka-net       bridge    local
ba201315ce17   none            null      local
1e7a79e8742e   zookeeper-net   bridge    local
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 13:47:30
```

ä¹‹ååœ¨æˆ‘ä»¬åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ `--network` æ¥æŒ‡å®šå®¹å™¨æ‰€åŠ å…¥çš„ç½‘ç»œï¼Œä¸€æ—¦è¿™ä¸ªå‚æ•°è¢«æŒ‡å®šï¼Œå®¹å™¨ä¾¿ä¸ä¼šé»˜è®¤åŠ å…¥åˆ° bridge è¿™ä¸ªç½‘ç»œä¸­äº† ( ä½†æ˜¯ä»ç„¶å¯ä»¥é€šè¿‡ `--network bridge` è®©å…¶åŠ å…¥ )ã€‚

```bash
$ sudo docker run -d --name mysql -e MYSQL_RANDOM_ROOT_PASSWORD=yes --network individual mysql:5.7
```

æˆ‘ä»¬é€šè¿‡ `docker inspect` è§‚å¯Ÿä¸€ä¸‹æ­¤æ—¶çš„å®¹å™¨ç½‘ç»œã€‚

```bash
$ sudo docker inspect mysql
[
    {
// ......
        "NetworkSettings": {
// ......
            "Networks": {
                "individual": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": [
                        "2ad678e6d110"
                    ],
                    "NetworkID": "35c3ef1cc27d24e15a2b22bdd606dc28e58f0593ead6a57da34a8ed989b1b15d",
                    "EndpointID": "41a2345b913a45c3c5aae258776fcd1be03b812403e249f96b161e50d66595ab",
                    "Gateway": "172.18.0.1",
                    "IPAddress": "172.18.0.2",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:12:00:02",
                    "DriverOpts": null
                }
            }
// ......
        }
// ......
    }
]
```

å¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨æ‰€åŠ å…¥ç½‘ç»œå·²ç»å˜æˆäº† `individual` è¿™ä¸ªç½‘ç»œäº†ã€‚

è¿™æ—¶å€™æˆ‘ä»¬é€šè¿‡ `--link` è®©å¤„äºå¦å¤–ä¸€ä¸ªç½‘ç»œçš„å®¹å™¨è¿æ¥åˆ°è¿™ä¸ªå®¹å™¨ä¸Šï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„æ•ˆæœã€‚

```bash
$ sudo docker run -d --name webapp --link mysql --network bridge webapp:latest
docker: Error response from daemon: Cannot link to /mysql, as it does not belong to the default network.
ERRO[0000] error waiting for container: context canceled
```

å¯ä»¥çœ‹åˆ°å®¹å™¨å¹¶ä¸èƒ½æ­£å¸¸çš„å¯åŠ¨ï¼Œè€Œ Docker æé†’æˆ‘ä»¬ä¸¤ä¸ªå®¹å™¨å¤„äºä¸åŒçš„ç½‘ç»œï¼Œä¹‹é—´æ˜¯ä¸èƒ½ç›¸äº’è¿æ¥å¼•ç”¨çš„ã€‚

æˆ‘ä»¬æ¥æ”¹å˜ä¸€ä¸‹ï¼Œè®©è¿è¡Œ Web åº”ç”¨çš„å®¹å™¨åŠ å…¥åˆ° `individual` è¿™ä¸ªç½‘ç»œï¼Œå°±å¯ä»¥æˆåŠŸå»ºç«‹å®¹å™¨é—´çš„ç½‘ç»œè¿æ¥äº†ã€‚

```bash
$ sudo docker run -d --name webapp --link mysql --network individual webapp:latest
```

---

### 2.2 è¿æ¥ç½‘ç»œ

é€šè¿‡ `docker network connect ç½‘ç»œåç§° å®¹å™¨åç§°` ä¸ºå®¹å™¨è¿æ¥æ–°çš„ç½‘ç»œæ¨¡å¼ã€‚

```bash
$ docker network connect kafka-net 281d7a01a6aa
```

é€šè¿‡ `docker inspect å®¹å™¨åç§°|ID` å†æ¬¡æŸ¥çœ‹å®¹å™¨çš„ç½‘ç»œä¿¡æ¯ï¼Œå¤šå¢åŠ äº†é»˜è®¤çš„ `bridge`ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 14:13:34
$ docker inspect 281d7a01a6aa
[
//...
            "Networks": {
                "bridge": {
//...
                },
                "kafka-net": {
//...
                }
            }
        }
    }
]
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 14:14:02
```

---

### 2.3 æ–­å¼€ç½‘ç»œ

é€šè¿‡ `docker network disconnect ç½‘ç»œåç§° å®¹å™¨åç§°` å‘½ä»¤æ–­å¼€ç½‘ç»œã€‚

```bash
$ docker network disconnect kafka-net 281d7a01a6aa
```

é€šè¿‡ `docker inspect å®¹å™¨åç§°|ID` å†æ¬¡æŸ¥çœ‹å®¹å™¨çš„ç½‘ç»œä¿¡æ¯ï¼Œå‘ç°åªå‰©ä¸‹é»˜è®¤çš„ bridgeã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 14:16:00
$ docker inspect 281d7a01a6aa
[
//...
            "Networks": {
                "bridge": {
//...
                }
            }
        }
    }
]
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 14:16:31
```

### 2.4 ç§»é™¤ç½‘ç»œ

å¯ä»¥é€šè¿‡ `docker network rm ç½‘ç»œåç§°` å‘½ä»¤ç§»é™¤è‡ªå®šä¹‰ç½‘ç»œæ¨¡å¼ï¼Œç½‘ç»œæ¨¡å¼ç§»é™¤æˆåŠŸä¼šè¿”å›ç½‘ç»œæ¨¡å¼åç§°ã€‚

```bash
docker network rm custom_network
```

> å¦‚æœé€šè¿‡æŸä¸ªè‡ªå®šä¹‰ç½‘ç»œæ¨¡å¼åˆ›å»ºäº†å®¹å™¨ï¼Œåˆ™è¯¥ç½‘ç»œæ¨¡å¼æ— æ³•åˆ é™¤ã€‚

---

## 3.å®¹å™¨äº’è”

ç”±äº Docker æå€¡å®¹å™¨ä¸åº”ç”¨å…±ç”Ÿçš„è½»é‡çº§å®¹å™¨ç†å¿µï¼Œæ‰€ä»¥å®¹å™¨ä¸­é€šå¸¸åªåŒ…å«ä¸€ç§åº”ç”¨ç¨‹åºï¼Œä½†æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚ä»Šçº·ç¹çš„ç³»ç»ŸæœåŠ¡ï¼Œæ²¡æœ‰å‡ ä¸ªæ˜¯å¯ä»¥é€šè¿‡å•ä¸€çš„åº”ç”¨ç¨‹åºæ”¯æ’‘çš„ã€‚æ‹¿æœ€ç®€å•çš„ Web åº”ç”¨ä¸ºä¾‹ï¼Œä¹Ÿè‡³å°‘éœ€è¦ä¸šåŠ¡åº”ç”¨ã€æ•°æ®åº“åº”ç”¨ã€ç¼“å­˜åº”ç”¨ç­‰ç»„æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ Docker é‡Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¤šä¸ªå®¹å™¨æ¥ç»„æˆè¿™æ ·çš„ç³»ç»Ÿã€‚

è€Œè¿™äº›äº’è”ç½‘æ—¶ä»£çš„åº”ç”¨ï¼Œå…¶é—´çš„é€šè®¯æ–¹å¼ä¸»è¦ä»¥ç½‘ç»œä¸ºä¸»ï¼Œæ‰€ä»¥æ‰“é€šå®¹å™¨é—´çš„ç½‘ç»œï¼Œæ˜¯ä½¿å®ƒä»¬èƒ½å¤Ÿäº’ç›¸é€šè®¯çš„å…³é”®æ‰€åœ¨ã€‚

è¦è®©ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å¦å¤–ä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨é€šè¿‡ `docker create` æˆ– `docker run` åˆ›å»ºæ—¶é€šè¿‡ `--link` é€‰é¡¹è¿›è¡Œé…ç½®ã€‚

ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª MySQL å®¹å™¨ï¼Œå°†è¿è¡Œæˆ‘ä»¬ Web åº”ç”¨çš„å®¹å™¨è¿æ¥åˆ°è¿™ä¸ª MySQL å®¹å™¨ä¸Šï¼Œæ‰“é€šä¸¤ä¸ªå®¹å™¨é—´çš„ç½‘ç»œï¼Œå®ç°å®ƒä»¬ä¹‹é—´çš„ç½‘ç»œäº’é€šã€‚

```bash
$ sudo docker run -d --name mysql -e MYSQL_RANDOM_ROOT_PASSWORD=yes mysql
$ sudo docker run -d --name webapp --link mysql webapp:latest
```

å®¹å™¨é—´çš„ç½‘ç»œå·²ç»æ‰“é€šï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•åœ¨ Web åº”ç”¨ä¸­è¿æ¥åˆ° MySQL æ•°æ®åº“å‘¢ï¼ŸDocker ä¸ºå®¹å™¨é—´è¿æ¥æä¾›äº†ä¸€ç§éå¸¸å‹å¥½çš„æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®¹å™¨çš„ç½‘ç»œå‘½åå¡«å…¥åˆ°è¿æ¥åœ°å€ä¸­ï¼Œå°±å¯ä»¥è®¿é—®éœ€è¦è¿æ¥çš„å®¹å™¨äº†ã€‚

å‡è®¾æˆ‘ä»¬åœ¨ Web åº”ç”¨ä¸­ä½¿ç”¨çš„æ˜¯ JDBC è¿›è¡Œæ•°æ®åº“è¿æ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¡«å†™è¿æ¥ã€‚

```java
String url = "jdbc:mysql://mysql:3306/webapp";
```

åœ¨è¿™é‡Œï¼Œè¿æ¥åœ°å€ä¸­çš„ `mysql` å°±å¥½ä¼¼æˆ‘ä»¬å¸¸è§çš„åŸŸåè§£æï¼ŒDocker ä¼šå°†å…¶æŒ‡å‘ MySQL å®¹å™¨çš„ IP åœ°å€ã€‚

Docker åœ¨å®¹å™¨äº’é€šä¸­ä¸ºæˆ‘ä»¬å¸¦æ¥çš„ä¸€é¡¹ä¾¿åˆ©ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸å†éœ€è¦çœŸå®çš„çŸ¥é“å¦å¤–ä¸€ä¸ªå®¹å™¨çš„ IP åœ°å€å°±èƒ½è¿›è¡Œè¿æ¥ã€‚å†å…·ä½“æ¥å¯¹æ¯”ï¼Œåœ¨ä»¥å¾€çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ¯åˆ‡æ¢ä¸€ä¸ªç¯å¢ƒ ( ä¾‹å¦‚å°†ç¨‹åºä»å¼€å‘ç¯å¢ƒæäº¤åˆ°æµ‹è¯•ç¯å¢ƒ )ï¼Œéƒ½éœ€è¦é‡æ–°é…ç½®ç¨‹åºä¸­çš„å„é¡¹è¿æ¥åœ°å€ç­‰å‚æ•°ï¼Œè€Œåœ¨ Docker é‡Œï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªï¼Œåªéœ€è¦ç¨‹åºä¸­é…ç½®è¢«è¿æ¥å®¹å™¨çš„åˆ«åï¼Œæ˜ å°„ IP çš„å·¥ä½œå°±äº¤ç»™ Docker å®Œæˆäº†ã€‚

---

### 3.1 æš´éœ²ç«¯å£

è™½ç„¶å®¹å™¨é—´çš„ç½‘ç»œæ‰“é€šäº†ï¼Œä½†å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»»æ„è®¿é—®è¢«è¿æ¥å®¹å™¨ä¸­çš„ä»»ä½•æœåŠ¡ã€‚Docker ä¸ºå®¹å™¨ç½‘ç»œå¢åŠ äº†ä¸€å¥—å®‰å…¨æœºåˆ¶ï¼Œåªæœ‰å®¹å™¨è‡ªèº«å…è®¸çš„ç«¯å£ï¼Œæ‰èƒ½è¢«å…¶ä»–å®¹å™¨æ‰€è®¿é—®ã€‚

è¿™ä¸ªå®¹å™¨è‡ªæˆ‘æ ‡è®°ç«¯å£å¯è¢«è®¿é—®çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¸ºæš´éœ²ç«¯å£ã€‚æˆ‘ä»¬åœ¨ `docker ps` çš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°å®¹å™¨æš´éœ²ç»™å…¶ä»–å®¹å™¨è®¿é—®çš„ç«¯å£ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 13:39:25
$ docker ps
CONTAINER ID   IMAGE                       COMMAND                   CREATED        STATUS                 PORTS                                                  NAMES
110b177c9f14   wurstmeister/kafka:latest   "start-kafka.sh"          27 hours ago   Up 27 hours            0.0.0.0:9094->9092/tcp                                 kafka2
859da7d4bc67   wurstmeister/kafka:latest   "start-kafka.sh"          27 hours ago   Up 27 hours            0.0.0.0:9093->9092/tcp                                 kafka1
881b429e9378   wurstmeister/kafka:latest   "start-kafka.sh"          27 hours ago   Up 27 hours            0.0.0.0:9092->9092/tcp                                 kafka0
7b3654b7cdd4   zookeeper:3.7.1             "/docker-entrypoint.â€¦"   3 days ago     Up 3 days              2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183->2181/tcp   zk3
c8590424503a   zookeeper:3.7.1             "/docker-entrypoint.â€¦"   3 days ago     Up 3 days              2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182->2181/tcp   zk2
cedc3b13641c   zookeeper:3.7.1             "/docker-entrypoint.â€¦"   3 days ago     Up 3 days              2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   zk1
476c1d4950ac   a4ad24fe52cd                "/entrypoint.sh mysqâ€¦"   5 months ago   Up 12 days (healthy)   0.0.0.0:3306->3306/tcp, 33060/tcp                      mysql57
a9fd41cc2bbf   8bcb4cae919c                "/bin/tini -- /usr/lâ€¦"   5 months ago   Up 12 days             0.0.0.0:5601->5601/tcp                                 kibana
a7650bb02925   e082d8ac7e5e                "/bin/tini -- /usr/lâ€¦"   5 months ago   Up 12 days             0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp         elasticsearch
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 13:39:30
```
è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œmysql57 è¿™ä¸ªå®¹å™¨æš´éœ²çš„ç«¯å£æ˜¯ 3306 å’Œ 33060ã€‚æ‰€ä»¥æˆ‘ä»¬è¿æ¥åˆ° MySQL å®¹å™¨åï¼Œåªèƒ½å¯¹è¿™ä¸¤ä¸ªç«¯å£è¿›è¡Œè®¿é—®ã€‚

ç«¯å£çš„æš´éœ²å¯ä»¥é€šè¿‡ Docker é•œåƒè¿›è¡Œå®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨å®¹å™¨åˆ›å»ºæ—¶è¿›è¡Œå®šä¹‰ã€‚åœ¨å®¹å™¨åˆ›å»ºæ—¶è¿›è¡Œå®šä¹‰çš„æ–¹æ³•æ˜¯å€ŸåŠ© `--expose` è¿™ä¸ªé€‰é¡¹ã€‚

```bash
$ sudo docker run -d --name mysql57 -e MYSQL_RANDOM_ROOT_PASSWORD=yes --expose 13306 --expose 23306 mysql:5.7
```

è¿™é‡Œæˆ‘ä»¬ä¸º MySQL æš´éœ²äº† 13306 å’Œ 23306 è¿™ä¸¤ä¸ªç«¯å£ï¼Œæš´éœ²åæˆ‘ä»¬å¯ä»¥åœ¨ `docker ps` ä¸­çœ‹åˆ°è¿™ä¸¤ä¸ªç«¯å£å·²ç»æˆåŠŸçš„æ‰“å¼€ã€‚

```bash
$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                       NAMES
3c4e645f21d7        mysql:5.7           "docker-entrypoint.sâ€¦"   4 seconds ago       Up 3 seconds        3306/tcp, 13306/tcp, 23306/tcp, 33060/tcp   mysql
```

å®¹å™¨æš´éœ²äº†ç«¯å£åªæ˜¯ç±»ä¼¼æˆ‘ä»¬æ‰“å¼€äº†å®¹å™¨çš„é˜²ç«å¢™ï¼Œå…·ä½“èƒ½ä¸èƒ½é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—®å®¹å™¨ä¸­çš„æœåŠ¡ï¼Œè¿˜éœ€è¦å®¹å™¨ä¸­çš„åº”ç”¨ç›‘å¬å¹¶å¤„ç†æ¥è‡ªè¿™ä¸ªç«¯å£çš„è¯·æ±‚ã€‚

---

### 3.2 é€šè¿‡åˆ«åè¿æ¥

çº¯ç²¹çš„é€šè¿‡å®¹å™¨åæ¥æ‰“å¼€å®¹å™¨é—´çš„ç½‘ç»œé€šé“ç¼ºä¹ä¸€å®šçš„çµæ´»æ€§ï¼Œåœ¨ Docker é‡Œè¿˜æ”¯æŒè¿æ¥æ—¶ä½¿ç”¨åˆ«åæ¥ä½¿æˆ‘ä»¬æ‘†è„±å®¹å™¨åçš„é™åˆ¶ã€‚

```bash
$ sudo docker run -d --name webapp --link mysql:database webapp:latest
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ `--link <name>:<alias>` çš„å½¢å¼ï¼Œè¿æ¥åˆ° MySQL å®¹å™¨ï¼Œå¹¶è®¾ç½®å®ƒçš„åˆ«åä¸º `database`ã€‚å½“æˆ‘ä»¬è¦åœ¨ Web åº”ç”¨ä¸­ä½¿ç”¨ MySQL è¿æ¥æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `database` æ¥ä»£æ›¿è¿æ¥åœ°å€äº†ã€‚

```java
String url = "jdbc:mysql://database:3306/webapp";
```

### 3.3 Docker DNS 

ä¸Šé¢ä¸¤èŠ‚ä»‹ç»çš„å†…å®¹å·²ç»è¿‡æ—¶äº†ï¼Œdocker å®˜æ–¹æ¨èæ–°çš„æ–¹å¼ã€‚

é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œ**å®¹å™¨ä¹‹é—´è¦äº’ç›¸é€šä¿¡ï¼Œå¿…é¡»è¦æœ‰å±äºåŒä¸€ä¸ªç½‘ç»œçš„ç½‘å¡**ã€‚

å…ˆåˆ›å»ºä¸¤ä¸ªåŸºäºé»˜è®¤çš„ `bridge` ç½‘ç»œæ¨¡å¼çš„å®¹å™¨ã€‚

```bash
docker run -di --name default_bbox01 busybox
docker run -di --name default_bbox02 busybox
```

é€šè¿‡ `docker network inspect bridge` æŸ¥çœ‹ä¸¤å®¹å™¨çš„å…·ä½“ IP ä¿¡æ¯ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 15:54:50
$ docker network inspect bridge
[
    {
//...
        "Containers": {

            "33d2aaa177cbf820edacbe2fb200d6d6ae88d0ae7c64a54029795ff683baca95": {
                "Name": "default_bbox02",
                "EndpointID": "70cc2381e67ec52ad52c2904a5abdd27c117ae7f36f4ad79a8dd2c8394464954",
                "MacAddress": "02:42:ac:11:00:07",
                "IPv4Address": "172.17.0.7/16",
                "IPv6Address": ""
            },
            "caa59faf6906f6b0b11a8385c7931460858604657c5f8de1d3ab638e91024a9b": {
                "Name": "default_bbox01",
                "EndpointID": "de9afabc43c32e4e9239abf4261ae64f245a5c12aaf62d425b3eaa97af137af7",
                "MacAddress": "02:42:ac:11:00:06",
                "IPv4Address": "172.17.0.6/16",
                "IPv6Address": ""
            }
        },
//...
    }
]
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 15:54:59
```

ç„¶åæµ‹è¯•ä¸¤å®¹å™¨é—´æ˜¯å¦å¯ä»¥è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 15:54:59
$ docker exec -it default_bbox01 ping 172.17.0.7      
PING 172.17.0.7 (172.17.0.7): 56 data bytes
64 bytes from 172.17.0.7: seq=0 ttl=64 time=1.289 ms
64 bytes from 172.17.0.7: seq=1 ttl=64 time=0.193 ms
64 bytes from 172.17.0.7: seq=2 ttl=64 time=0.142 ms
64 bytes from 172.17.0.7: seq=3 ttl=64 time=0.361 ms
^C
--- 172.17.0.7 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 0.142/0.496/1.289 ms
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 15:57:30
```

ç»è¿‡æµ‹è¯•ï¼Œä»ç»“æœå¾—çŸ¥ä¸¤ä¸ªå±äºåŒä¸€ä¸ªç½‘ç»œçš„å®¹å™¨æ˜¯å¯ä»¥è¿›è¡Œç½‘ç»œé€šä¿¡çš„ï¼Œä½†æ˜¯ IP åœ°å€å¯èƒ½æ˜¯ä¸å›ºå®šçš„ï¼Œæœ‰è¢«æ›´æ”¹çš„æƒ…å†µå‘ç”Ÿï¼Œé‚£å®¹å™¨å†…æ‰€æœ‰é€šä¿¡çš„ IP åœ°å€ä¹Ÿéœ€è¦è¿›è¡Œæ›´æ”¹ï¼Œèƒ½å¦ä½¿ç”¨å®¹å™¨åç§°è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Ÿç»§ç»­æµ‹è¯•ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 15:57:30
$ docker exec -it default_bbox01 ping default_bbox02
ping: bad address 'default_bbox02'
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 15:58:39
```

ç»è¿‡æµ‹è¯•ï¼Œä»ç»“æœå¾—çŸ¥ä½¿ç”¨å®¹å™¨è¿›è¡Œç½‘ç»œé€šä¿¡æ˜¯ä¸è¡Œçš„ï¼Œé‚£æ€ä¹ˆå®ç°è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿ

ä» Docker 1.10 ç‰ˆæœ¬å¼€å§‹ï¼Œ`docker daemon` å®ç°äº†ä¸€ä¸ªå†…åµŒçš„ **DNS server**ï¼Œä½¿å®¹å™¨å¯ä»¥ç›´æ¥é€šè¿‡å®¹å™¨åç§°é€šä¿¡ã€‚æ–¹æ³•å¾ˆç®€å•ï¼Œåªè¦åœ¨åˆ›å»ºå®¹å™¨æ—¶ä½¿ç”¨ `--name` ä¸ºå®¹å™¨å‘½åå³å¯ã€‚

ä½†æ˜¯ä½¿ç”¨ **Docker DNS** æœ‰ä¸ªé™åˆ¶ï¼šåªèƒ½åœ¨ `user-defined` ç½‘ç»œä¸­ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤çš„ bridge ç½‘ç»œæ˜¯æ— æ³•ä½¿ç”¨ DNS çš„ï¼Œæ‰€ä»¥å°±éœ€è¦è‡ªå®šä¹‰ç½‘ç»œã€‚

å…ˆåŸºäº bridge ç½‘ç»œæ¨¡å¼åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ `huidong-test-aaa`ï¼Œç„¶ååˆ›å»ºä¸¤ä¸ªåŸºäºè‡ªå®šä¹‰ç½‘ç»œæ¨¡å¼çš„å®¹å™¨ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:00:02
$ docker network create huidong-test-aaa            
e5994135175b7de7b1f83a2bea4d6c8ebc62e4da9c1a6aa3a8ddea4e4d9053d0
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:00:16
```

```bash
docker run -di --name custom_bbox01 --net huidong-test-aaa busybox
docker run -di --name custom_bbox02 --net huidong-test-aaa busybox
```

ç„¶åæµ‹è¯•ä¸¤å®¹å™¨é—´æ˜¯å¦å¯ä»¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œåˆ†åˆ«ä½¿ç”¨å…·ä½“ IP å’Œå®¹å™¨åç§°è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚

å…ˆä½¿ç”¨ `docker inspect` å‘½ä»¤æŸ¥çœ‹è¿™ä¸¤ä¸ªå®¹å™¨çš„IPã€‚

````json
        {
            "76c84121d9fd8378f8210ca706f9da1804f1d34d2b1cd4588b35cec141f835ec": {
                "Name": "custom_bbox02",
                "EndpointID": "878e1c80e7fe463cd73363cb8609b334e71c78f039c09ba8a66b87a21ea90df1",
                "MacAddress": "02:42:ac:14:00:03",
                "IPv4Address": "172.20.0.3/16",
                "IPv6Address": ""
            },
            "b674918ab956e1bb363b790ec04ee85a9cdef918e71c890bf11493b41df2acbc": {
                "Name": "custom_bbox01",
                "EndpointID": "e8ca34dd08760e46275eb4fe8614a283f51bd66eb342a9c6d0eb1bbdfbb0f0c1",
                "MacAddress": "02:42:ac:14:00:02",
                "IPv4Address": "172.20.0.2/16",
                "IPv6Address": ""
            }
        }
````

ä½¿ç”¨IP ping ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:04:32
$ docker exec -it custom_bbox01 ping 172.20.0.3
PING 172.20.0.3 (172.20.0.3): 56 data bytes
64 bytes from 172.20.0.3: seq=0 ttl=64 time=1.271 ms
64 bytes from 172.20.0.3: seq=1 ttl=64 time=0.239 ms
64 bytes from 172.20.0.3: seq=2 ttl=64 time=0.337 ms
^C
--- 172.20.0.3 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.239/0.615/1.271 ms
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:04:46
```

ä½¿ç”¨å®¹å™¨åpingã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:04:46
$ docker exec -it custom_bbox01 ping custom_bbox02          
PING custom_bbox02 (172.20.0.3): 56 data bytes
64 bytes from 172.20.0.3: seq=0 ttl=64 time=0.346 ms
64 bytes from 172.20.0.3: seq=1 ttl=64 time=0.310 ms
64 bytes from 172.20.0.3: seq=2 ttl=64 time=0.526 ms
64 bytes from 172.20.0.3: seq=3 ttl=64 time=0.429 ms
^C
--- custom_bbox02 ping statistics ---
14 packets transmitted, 14 packets received, 0% packet loss
round-trip min/avg/max = 0.193/0.377/0.526 ms
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:05:40
```

ç»è¿‡æµ‹è¯•ï¼Œä»ç»“æœå¾—çŸ¥ä¸¤ä¸ªå±äºåŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œçš„å®¹å™¨æ˜¯å¯ä»¥è¿›è¡Œç½‘ç»œé€šä¿¡çš„ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å®¹å™¨åç§°è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚

é‚£å¦‚æœæ­¤æ—¶å¸Œæœ› bridge ç½‘ç»œä¸‹çš„å®¹å™¨å¯ä»¥å’Œ `huidong-test-aaa` ç½‘ç»œä¸‹çš„å®¹å™¨è¿›è¡Œç½‘ç»œåˆè¯¥å¦‚ä½•æ“ä½œï¼Ÿå…¶å®ç­”æ¡ˆä¹Ÿéå¸¸ç®€å•ï¼šè®© bridge ç½‘ç»œä¸‹çš„å®¹å™¨è¿æ¥è‡³æ–°çš„ `huidong-test-aaa` ç½‘ç»œå³å¯ã€‚

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:07:38
$ docker network connect huidong-test-aaa default_bbox01
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:07:40
```

```bash
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:07:40
$ docker exec -it custom_bbox01 ping default_bbox01     
PING default_bbox01 (172.20.0.4): 56 data bytes
64 bytes from 172.20.0.4: seq=0 ttl=64 time=0.984 ms
64 bytes from 172.20.0.4: seq=1 ttl=64 time=0.874 ms
64 bytes from 172.20.0.4: seq=2 ttl=64 time=0.578 ms
^C
--- default_bbox01 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.578/0.812/0.984 ms
ğŸ‘¨ HuidongYin ğŸ“Œ  ~ âŒš 24-01-09 16:08:29
```

ç»è¿‡æµ‹è¯•ï¼Œä¹Ÿæ˜¯å¯ä»¥é€šçš„ã€‚

---


## 4.ç«¯å£æ˜ å°„

åˆšæ‰æˆ‘ä»¬æåŠçš„éƒ½æ˜¯å®¹å™¨ç›´æ¥é€šè¿‡ Docker ç½‘ç»œè¿›è¡Œçš„äº’ç›¸è®¿é—®ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦åœ¨å®¹å™¨å¤–é€šè¿‡ç½‘ç»œè®¿é—®å®¹å™¨ä¸­çš„åº”ç”¨ã€‚æœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æä¾›äº† Web æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æä¾›ä¸€ç§æ–¹å¼è®¿é—®è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ Web åº”ç”¨ã€‚

åœ¨ Docker ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªç«¯å£æ˜ å°„çš„åŠŸèƒ½å®ç°è¿™æ ·çš„éœ€æ±‚ã€‚

![](https://raw.githubusercontent.com/huidongyin/DrawingBed/main/Docker/202401092121534.webp)

é€šè¿‡ Docker ç«¯å£æ˜ å°„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æ“ä½œç³»ç»Ÿçš„ç«¯å£ä¸Šï¼Œå½“æˆ‘ä»¬ä»å¤–éƒ¨è®¿é—®å®¿ä¸»æ“ä½œç³»ç»Ÿçš„ç«¯å£æ—¶ï¼Œæ•°æ®è¯·æ±‚å°±ä¼šè‡ªåŠ¨å‘é€ç»™ä¸ä¹‹å…³è”çš„å®¹å™¨ç«¯å£ã€‚

è¦æ˜ å°„ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºå®¹å™¨æ—¶ä½¿ç”¨ -p æˆ–è€…æ˜¯ `--publish` é€‰é¡¹ã€‚

```bash
$ sudo docker run -d --name nginx -p 80:80 -p 443:443 nginx:1.12
```

ä½¿ç”¨ç«¯å£æ˜ å°„é€‰é¡¹çš„æ ¼å¼æ˜¯ `-p <ip>:<host-port>:<container-port>`ï¼Œå…¶ä¸­ ip æ˜¯å®¿ä¸»æ“ä½œç³»ç»Ÿçš„ç›‘å¬ ipï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶ç›‘å¬çš„ç½‘å¡ï¼Œé»˜è®¤ä¸º `0.0.0.0`ï¼Œä¹Ÿå°±æ˜¯ç›‘å¬æ‰€æœ‰ç½‘å¡ã€‚`host-port` å’Œ `container-port` åˆ†åˆ«è¡¨ç¤ºæ˜ å°„åˆ°å®¿ä¸»æ“ä½œç³»ç»Ÿçš„ç«¯å£å’Œå®¹å™¨çš„ç«¯å£ï¼Œè¿™ä¸¤è€…æ˜¯å¯ä»¥ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æ“ä½œç³»ç»Ÿçš„ 8080 ç«¯å£ï¼Œä¼ å…¥ -p 8080:80 å³å¯ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨åˆ—è¡¨é‡Œçœ‹åˆ°ç«¯å£æ˜ å°„çš„é…ç½®ã€‚

```bash
$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                      NAMES
bc79fc5d42a6        nginx:1.12          "nginx -g 'daemon ofâ€¦"   4 seconds ago       Up 2 seconds        0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp   nginx
```

æ‰“å°çš„ç»“æœé‡Œç”¨ `->` æ ‡è®°äº†ç«¯å£çš„æ˜ å°„å…³ç³»ã€‚

---

