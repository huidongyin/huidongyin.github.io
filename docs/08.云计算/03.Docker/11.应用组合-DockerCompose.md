---
title: åº”ç”¨ç»„åˆ-DockerCompose
date: 2024-01-09 00:00:00
tags:
    - Docker
    - äº‘è®¡ç®—
categories:
    - Docker
description: åº”ç”¨ç»„åˆ-DockerCompose
toc_number: false
author:
    name: huidong.yin
    link: https://huidongyin.github.io
permalink: /pages/299ec4fe-1e43-31a4-af2e-0ab7258a19ec/

---

æˆ‘ä»¬å·²ç»åŸºæœ¬æŒæ¡äº†æ„å»ºã€è¿è¡Œå®¹å™¨çš„æ–¹æ³•ï¼Œä½†æ˜¯ç”±äº Docker é‡‡ç”¨è½»é‡çº§å®¹å™¨çš„è®¾è®¡ï¼Œæ¯ä¸ªå®¹å™¨ä¸€èˆ¬åªè¿è¡Œä¸€ä¸ªè½¯ä»¶ï¼Œè€Œç»å¤§å¤šæ•°åº”ç”¨ç³»ç»Ÿéƒ½ç»ä¸æ˜¯ä¸€ä¸ªè½¯ä»¶æ‰€èƒ½ç»„æˆçš„ã€‚è™½ç„¶æˆ‘ä»¬ä¹‹å‰æåˆ°äº†å®¹å™¨é—´äº’ç›¸è¿æ¥ã€äº¤æ¢æ•°æ®çš„å„ç§æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•è¶³ä»¥æ­å»ºèµ·å®Œæ•´çš„ç”¨äºåº”ç”¨ç³»ç»Ÿè¿è¡Œçš„å®¹å™¨ç¾¤ï¼Œä½†æ˜¯è¿™ä¸ªå®¹å™¨ç¾¤çš„æ­å»ºéœ€è¦æ‰§è¡Œå¤ªå¤šå‘½ä»¤ï¼Œæ›´é‡è¦çš„æ˜¯éœ€è¦è€ƒè™‘å¤ªå¤šåº”ç”¨å’Œå®¹å™¨é—´çš„ä¾èµ–å…³ç³»å¤„ç†ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°±æ¥ä»‹ç»è§£å†³è¿™äº›é—®é¢˜çš„ä¸€ç§æ–¹æ¡ˆ **Docker Compose**ã€‚

---

## 1.Docker Composeæ˜¯ä»€ä¹ˆ

Docker Composeèƒ½å¤Ÿåœ¨ Docker èŠ‚ç‚¹ä¸Šï¼Œä»¥å•å¼•æ“æ¨¡å¼(Single-Engine Mode)è¿›è¡Œå¤šå®¹å™¨åº”ç”¨çš„éƒ¨ ç½²å’Œç®¡ç†ã€‚å¤šæ•°çš„ç°ä»£åº”ç”¨é€šè¿‡å¤šä¸ªæ›´å°çš„å¾®æœåŠ¡äº’ç›¸ååŒæ¥ç»„æˆä¸€ä¸ªå®Œæ•´å¯ç”¨çš„åº”ç”¨ã€‚

éƒ¨ç½²å’Œç®¡ç†ç¹å¤šçš„æœåŠ¡æ˜¯å›°éš¾çš„ã€‚è€Œè¿™æ­£æ˜¯ Docker Compose è¦è§£å†³çš„é—®é¢˜ã€‚Docker Compose å¹¶ä¸æ˜¯é€šè¿‡è„šæœ¬å’Œå„ç§å†—é•¿çš„ docker å‘½ä»¤æ¥å°†åº”ç”¨ç»„ä»¶ç»„ç»‡èµ·æ¥ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå£°æ˜å¼çš„é…ç½®æ–‡ä»¶æè¿°æ•´ä¸ªåº”ç”¨ï¼Œä»è€Œä½¿ç”¨ä¸€æ¡å‘½ä»¤å®Œæˆéƒ¨ç½²ã€‚åº”ç”¨éƒ¨ç½²æˆåŠŸåï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—ç®€å•çš„å‘½ä»¤å®ç°å¯¹å…¶å®Œæ•´ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ã€‚ç”šè‡³ï¼Œé…ç½®æ–‡ä»¶è¿˜å¯ä»¥ç½®äºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­è¿›è¡Œå­˜å‚¨å’Œç®¡ç†ã€‚

å¦‚æœè¯´ Dockerfile æ˜¯å°†å®¹å™¨å†…è¿è¡Œç¯å¢ƒçš„æ­å»ºå›ºåŒ–ä¸‹æ¥ï¼Œé‚£ä¹ˆ Docker Compose æˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸ºå°†å¤šä¸ªå®¹å™¨è¿è¡Œçš„æ–¹å¼å’Œé…ç½®å›ºåŒ–ä¸‹æ¥ã€‚

![](https://raw.githubusercontent.com/huidongyin/DrawingBed/main/Docker/202401112209216.webp)

---

### 1.1 Docker Compose å®‰è£…

Docker Compose ç›®å‰æ˜¯ç”± Docker å®˜æ–¹ä¸»è¦ç»´æŠ¤ï¼Œä½†æ˜¯å´ä¸å±äº Docker Engine çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è½¯ä»¶ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦åœ¨ Linux ä¸­ä½¿ç”¨å®ƒï¼Œè¦å•ç‹¬ä¸‹è½½ä½¿ç”¨ã€‚

Docker Compose æ˜¯ä¸€ä¸ªç”± Python ç¼–å†™çš„è½¯ä»¶ï¼Œåœ¨æ‹¥æœ‰ Python è¿è¡Œç¯å¢ƒçš„æœºå™¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿è¡Œå®ƒï¼Œä¸éœ€è¦å…¶å®ƒçš„æ“ä½œã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ä¸‹è½½ Docker Compose åˆ°åº”ç”¨æ‰§è¡Œç›®å½•ï¼Œå¹¶é™„ä¸Šè¿è¡Œæƒé™ï¼Œè¿™æ · Docker Compose å°±å¯ä»¥åœ¨æœºå™¨ä¸­ä½¿ç”¨äº†ã€‚

```bash
$ curl -L "https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
$ chmod +x /usr/local/bin/docker-compose
$
$ docker-compose version
Docker Compose version v2.23.3-desktop.2
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ Python çš„åŒ…ç®¡ç†å·¥å…· `pip` æ¥å®‰è£… Docker Composeã€‚

```python
pip install docker-compose
```

å¯¹äºWindowå’ŒMacï¼Œä½¿ç”¨ Docker for Win æˆ–è€… Docker for Macæ¥æ­å»º Docker è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `docker-compose` è¿™ä¸ªå‘½ä»¤ã€‚è¿™æ¬¾è½¯ä»¶å·²ç»å°† Docker Compose å†…ç½®åœ¨å…¶ä¸­ï¼Œä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚

---

### 1.2 é…ç½®æ–‡ä»¶åŠå¸¸ç”¨å‘½ä»¤

Docker Compose ä½¿ç”¨ YAML æ–‡ä»¶æ¥å®šä¹‰å¤šæœåŠ¡çš„åº”ç”¨ã€‚YAML æ˜¯ JSON çš„ä¸€ä¸ªå­é›†ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨JSONã€‚Docker Compose é»˜è®¤ä½¿ç”¨æ–‡ä»¶å `docker-compose.yml`ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `-f` å‚æ•°æŒ‡å®šå…·ä½“æ–‡ä»¶ã€‚

```yaml
version: '3'
services:
     mysql:
      build:
        context: ./mysql
      environment:
        MYSQL_ROOT_PASSWORD: root
      restart: always
      container_name: mysql
      volumes:
        - /data/bom/mysql/test:/var/lib/mysql
      image: mysql/mysql:5.7
      ports:
        - "3306:3306"

     eureka:
      build:
        context: ./eureka-boot
      restart: always
      ports:
        - "8761:8761"
      container_name: eureka-boot
      hostname: eureka-boot
      image: eureka:1.0
      depends_on:
        - mysql

networks:
    net:
volumes:
    vol:
```


Docker Compose çš„ YAML æ–‡ä»¶åŒ…å« 4 ä¸ªä¸€çº§ key:`version`ã€`services`ã€`networks`ã€`volumes`ã€‚

* `version` æ˜¯å¿…é¡»æŒ‡å®šçš„ï¼Œè€Œä¸”æ€»æ˜¯ä½äºæ–‡ä»¶çš„ç¬¬ä¸€è¡Œã€‚å®ƒå®šä¹‰äº† Compose æ–‡ä»¶æ ¼å¼(ä¸»è¦æ˜¯ API)çš„ç‰ˆæœ¬ã€‚æ³¨æ„ï¼Œversion å¹¶éå®šä¹‰ Docker Compose æˆ– Docker å¼•æ“çš„ç‰ˆæœ¬å·ã€‚
* `services` ç”¨äºå®šä¹‰ä¸åŒçš„åº”ç”¨æœåŠ¡ã€‚ä¸Šè¾¹çš„ä¾‹å­å®šä¹‰äº†ä¸¤ä¸ªæœåŠ¡:ä¸€ä¸ªåä¸º mysqlæ•°æ®åº“æœ åŠ¡ä»¥åŠä¸€ä¸ªåä¸ºeurekaçš„å¾®æœã€‚Docker Compose ä¼šå°†æ¯ä¸ªæœåŠ¡éƒ¨ç½²åœ¨å„è‡ªçš„å®¹å™¨ä¸­ã€‚
* `networks` ç”¨äºæŒ‡å¼• Docker åˆ›å»ºæ–°çš„ç½‘ç»œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker Compose ä¼šåˆ›å»º `bridge` ç½‘ç»œã€‚ è¿™æ˜¯ä¸€ç§å•ä¸»æœºç½‘ç»œï¼Œåªèƒ½å¤Ÿå®ç°åŒä¸€ä¸»æœºä¸Šå®¹å™¨çš„è¿æ¥ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `driver` å±æ€§æ¥æŒ‡å®šä¸ åŒçš„ç½‘ç»œç±»å‹ã€‚
* `volumes` ç”¨äºæŒ‡å¼• Docker æ¥åˆ›å»ºæ–°çš„å·ã€‚

---

#### 1)å¯åŠ¨å’Œåœæ­¢

Docker Compose çš„å¯åŠ¨å’Œåœæ­¢å‘½ä»¤æ˜¯ `docker-compose up` å’Œ `docker-compose down` ã€‚

`docker-compose up` å‘½ä»¤ç±»ä¼¼äº Docker Engine ä¸­çš„ `docker run`ï¼Œå®ƒä¼šæ ¹æ® `docker-compose.yml` ä¸­é…ç½®çš„å†…å®¹ï¼Œåˆ›å»ºæ‰€æœ‰çš„å®¹å™¨ã€ç½‘ç»œã€æ•°æ®å·ç­‰ç­‰å†…å®¹ï¼Œå¹¶å°†å®ƒä»¬å¯åŠ¨ã€‚ä¸ `docker run `ä¸€æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ `docker-compose up `ä¼šåœ¨â€œå‰å°â€è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `-d `é€‰é¡¹ä½¿å…¶â€œåå°â€è¿è¡Œã€‚

```yaml
docker-compose up -d
```

>  `docker-compose` å‘½ä»¤é»˜è®¤ä¼šè¯†åˆ«å½“å‰æ§åˆ¶å°æ‰€åœ¨ç›®å½•å†…çš„ `docker-compose.yml` æ–‡ä»¶ï¼Œè€Œä¼šä»¥è¿™ä¸ªç›®å½•çš„åå­—ä½œä¸ºç»„è£…çš„åº”ç”¨é¡¹ç›®çš„åç§°ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æ”¹å˜å®ƒä»¬ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹ `-f `æ¥ä¿®æ”¹è¯†åˆ«çš„ Docker Compose é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ `-p` é€‰é¡¹æ¥å®šä¹‰é¡¹ç›®åã€‚

```yaml
docker-compose -f ~/docker-compose.yml -p dev-env up -d
```

ä¸ `docker-compose up` ç›¸åï¼Œ`docker-compose down` å‘½ä»¤ç”¨äºåœæ­¢æ‰€æœ‰çš„å®¹å™¨ï¼Œå¹¶å°†å®ƒä»¬åˆ é™¤ï¼ŒåŒæ—¶æ¶ˆé™¤ç½‘ç»œç­‰é…ç½®å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å‡ ä¹å°†è¿™ä¸ª Docker Compose é¡¹ç›®çš„æ‰€æœ‰å½±å“ä» Docker ä¸­æ¸…é™¤ã€‚

```yaml
docker-compose down
```

å€ŸåŠ© Docker å®¹å™¨çš„ç§’çº§å¯åŠ¨å’Œåœæ­¢ç‰¹æ€§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ `docker-compose up` å’Œ `docker-compose down` æ—¶å¯ä»¥éå¸¸å¿«çš„å®Œæˆæ“ä½œã€‚è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åˆ°åŠåˆ†é’Ÿçš„æ—¶é—´å†…åœæ­¢ä¸€å¥—ç¯å¢ƒï¼Œåˆ‡æ¢åˆ°å¦å¤–ä¸€å¥—ç¯å¢ƒã€‚é€šè¿‡ Docker è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å¼€å‘è¿‡ç¨‹ä¸­æ­å»ºä¸€å¥—ä¸å—å¹²æ‰°çš„ç‹¬ç«‹ç¯å¢ƒï¼Œè®©å¼€å‘è¿‡ç¨‹èƒ½å¤ŸåŸºäºç¨³å®šçš„ç¯å¢ƒä¸‹è¿›è¡Œã€‚è€Œ Docker Compose åˆ™è®©æˆ‘ä»¬æ›´è¿‘ä¸€æ­¥ï¼ŒåŒæ—¶è®©æˆ‘ä»¬å¤„ç†å¥½å¤šå¥—å¼€å‘ç¯å¢ƒï¼Œå¹¶è¿›è¡Œå¿«é€Ÿåˆ‡æ¢ã€‚

---

#### 2)å®¹å™¨å‘½ä»¤

1. åˆ—å‡ºæ‰€æœ‰è¿è¡Œçš„å®¹å™¨

```yaml
docker-compose ps
```

2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```yaml
docker-compose logs
```

3. æ„å»ºæœåŠ¡

```yaml
docker-compose build
```

4. å¯åŠ¨æœåŠ¡

- `start` å‘½ä»¤ä¼šå¯åŠ¨ä¹‹å‰é€šè¿‡ `docker-compose stop` å‘½ä»¤åœæ­¢çš„æœåŠ¡å®¹å™¨ã€‚
- `start` åªèƒ½å¯åŠ¨å·²ç»å­˜åœ¨ä½†å½“å‰å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œæ— æ³•åˆ›å»ºæ–°çš„å®¹å™¨ã€‚
- ä¸ `up` ä¸åŒï¼Œ`start` ä¸ä¼šè¯»å– `docker-compose.yml` æ–‡ä»¶ã€‚å®ƒä¸“é—¨ç”¨äºé‡æ–°å¯åŠ¨å…ˆå‰åœæ­¢çš„å®¹å™¨ã€‚

`up` ä¸»è¦ç”¨äºé¦–æ¬¡å¯åŠ¨å’Œåˆ›å»ºå®¹å™¨ï¼Œè€Œ `start` ç”¨äºé‡æ–°å¯åŠ¨ä¹‹å‰åœæ­¢çš„å®¹å™¨ã€‚å¦‚æœéœ€è¦å¯åŠ¨æ•´ä¸ªåº”ç”¨ç¨‹åºå¹¶åˆ›å»ºæ–°å®¹å™¨ï¼Œä½¿ç”¨ `up`ã€‚å¦‚æœåªæ˜¯æƒ³é‡æ–°å¯åŠ¨å·²ç»åœæ­¢çš„å®¹å™¨ï¼Œä½¿ç”¨ `start`ã€‚

```yaml
docker-compose start
```

5. åœæ­¢å·²ç»è¿è¡Œçš„æœåŠ¡

- `stop` å‘½ä»¤ä¼šåœæ­¢é€šè¿‡ `docker-compose up` å¯åŠ¨çš„æ‰€æœ‰å®¹å™¨ï¼Œä½†å¹¶ä¸ä¼šåˆ é™¤è¿™äº›å®¹å™¨ã€‚
- è¿™ä¸ªå‘½ä»¤ä¿ç•™äº†å®¹å™¨çš„çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ `docker-compose start` æˆ– `docker-compose restart` æ¢å¤è¿™äº›å®¹å™¨çš„è¿è¡Œã€‚
- ä½¿ç”¨ `stop` ä¸ä¼šåˆ é™¤å…³è”çš„ç½‘ç»œã€å·ç­‰ã€‚

`down` ç”¨äºå®Œå…¨åœæ­¢å¹¶æ¸…ç†æ•´ä¸ª Docker Compose é¡¹ç›®ï¼Œè€Œ `stop` ä»…ç”¨äºåœæ­¢å®¹å™¨ï¼Œä¿ç•™é¡¹ç›®çš„çŠ¶æ€ï¼Œæ–¹ä¾¿åç»­é‡æ–°å¯åŠ¨ã€‚é€‰æ‹©ä½¿ç”¨å“ªä¸ªå‘½ä»¤å–å†³äºéœ€æ±‚ï¼šæ˜¯è¦å½»åº•æ¸…ç†æ•´ä¸ªé¡¹ç›®ï¼Œè¿˜æ˜¯åªæ˜¯åœæ­¢å®¹å™¨å¹¶ä¿ç•™ç›¸å…³çŠ¶æ€ã€‚

```yaml
docker-compose stop
```

6. é‡å¯æœåŠ¡

```yaml
docker-compose restart
```

---

## 2.Docker Compose é…ç½®é¡¹

### 2.1 æœåŠ¡å®šä¹‰

#### 1)æŒ‡å®šé•œåƒ

åœ¨ Docker Compose é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä¸ºæœåŠ¡æŒ‡å®šæ‰€é‡‡ç”¨çš„é•œåƒã€‚ä¸€ç§æ˜¯é€šè¿‡ image è¿™ä¸ªé…ç½®ï¼Œè¿™ä¸ªç›¸å¯¹ç®€å•ï¼Œç»™å‡ºèƒ½åœ¨é•œåƒä»“åº“ä¸­æ‰¾åˆ°é•œåƒçš„åç§°å³å¯ã€‚

å¦å¤–ä¸€ç§æŒ‡å®šé•œåƒçš„æ–¹å¼å°±æ˜¯ç›´æ¥é‡‡ç”¨ Dockerfile æ¥æ„å»ºé•œåƒï¼Œé€šè¿‡ `build` è¿™ä¸ªé…ç½®æˆ‘ä»¬èƒ½å¤Ÿå®šä¹‰æ„å»ºçš„ç¯å¢ƒç›®å½•ï¼Œè¿™ä¸ `docker build` ä¸­çš„ç¯å¢ƒç›®å½•æ˜¯åŒä¸€ä¸ªå«ä¹‰ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹å¼æŒ‡å®šé•œåƒï¼Œé‚£ä¹ˆ Docker Compose å…ˆä¼šå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œé•œåƒçš„æ„å»ºï¼Œä¹‹åå†é€šè¿‡è¿™ä¸ªé•œåƒå¯åŠ¨å®¹å™¨ã€‚

å½“ç„¶ï¼Œåœ¨ `docker build` é‡Œæˆ‘ä»¬è¿˜èƒ½é€šè¿‡é€‰é¡¹å®šä¹‰è®¸å¤šå†…å®¹ï¼Œè¿™äº›åœ¨ Docker Compose é‡Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ã€‚

```yaml
services:
     mysql:
          build:
               context: ./mysql
      dockerfile: mysql-dockerfile
      args: 
	- JAVA_VERSION=1.6
```

åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨ Map çš„å½¢å¼æ¥å®šä¹‰ buildï¼Œåœ¨è¿™ç§æ ¼å¼ä¸‹ï¼Œæˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šæ›´å¤šçš„é•œåƒæ„å»ºå‚æ•°ï¼Œä¾‹å¦‚ Dockerfile çš„æ–‡ä»¶åï¼Œæ„å»ºå‚æ•°ç­‰ç­‰ã€‚

å½“ç„¶ï¼Œå¯¹äºä¸€äº›å¯ä»¥ä¸é€šè¿‡é‡æ–°æ„å»ºé•œåƒçš„æ–¹å¼ä¾¿èƒ½ä¿®æ”¹çš„å†…å®¹ï¼Œè¿˜æ˜¯ä¸å»ºè®®é‡æ–°æ„å»ºé•œåƒï¼Œè€Œæ˜¯ä½¿ç”¨åŸæœ‰çš„é•œåƒåšç®€å•çš„ä¿®æ”¹ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿®æ”¹ Redis çš„å¯åŠ¨å‘½ä»¤ï¼ŒåŠ å…¥é…ç½®æ–‡ä»¶ä»¥ä¾¿å¯¹ Redis æœåŠ¡è¿›è¡Œé…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `command` é…ç½®æ¥ä¿®æ”¹ã€‚è€Œåœ¨ MySQL çš„å®šä¹‰ï¼Œæˆ‘ä»¬é€šè¿‡ `environment`é…ç½®ä¸º MySQL è®¾ç½®äº†åˆå§‹å¯†ç ã€‚

ç”±äº Docker Compose çš„é…ç½®å·²ç»å›ºåŒ–ä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒå¿˜è®°ä¹‹å‰æ‰§è¡Œäº†å“ªäº›å‘½ä»¤æ¥å¯åŠ¨å®¹å™¨ï¼Œå½“æ¯æ¬¡éœ€è¦å¼€å¯æˆ–å…³é—­ç¯å¢ƒæ—¶ï¼Œåªéœ€è¦ `docker-compose up -d` å’Œ `docker-compose down` å‘½ä»¤ï¼Œå°±èƒ½è½»æ¾å®Œæˆæ“ä½œã€‚

---

#### 2)ä¾èµ–å£°æ˜

è™½ç„¶æˆ‘ä»¬åœ¨ Docker Compose çš„é…ç½®æ–‡ä»¶é‡Œå®šä¹‰æœåŠ¡ï¼Œåœ¨ä¹¦å†™ä¸Šæœ‰ç”±ä¸Šè‡³ä¸‹çš„å…ˆåå…³ç³»ï¼Œä½†å®é™…åœ¨å®¹å™¨å¯åŠ¨ä¸­ï¼Œç”±äºå„ç§å› ç´ çš„å­˜åœ¨ï¼Œå…¶é¡ºåºè¿˜æ˜¯æ— æ³•ä¿éšœçš„ã€‚

æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬çš„æœåŠ¡é—´æœ‰éå¸¸å¼ºçš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬å°±å¿…é¡»å‘ŠçŸ¥ Docker Compose å®¹å™¨çš„å…ˆåå¯åŠ¨é¡ºåºã€‚åªæœ‰å½“è¢«ä¾èµ–çš„å®¹å™¨å®Œå…¨å¯åŠ¨åï¼ŒDocker Compose æ‰ä¼šåˆ›å»ºå’Œå¯åŠ¨è¿™ä¸ªå®¹å™¨ã€‚

å®šä¹‰ä¾èµ–çš„æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ï¼Œä¹Ÿå°±æ˜¯ depends_on è¿™ä¸ªé…ç½®é¡¹ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å®ƒåˆ—å‡ºè¿™ä¸ªæœåŠ¡æ‰€æœ‰ä¾èµ–çš„å…¶ä»–æœåŠ¡å³å¯ã€‚åœ¨ Docker Compose ä¸ºæˆ‘ä»¬å¯åŠ¨é¡¹ç›®çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ‰€æœ‰ä¾èµ–ï¼Œå½¢æˆæ­£ç¡®çš„å¯åŠ¨é¡ºåºå¹¶æŒ‰è¿™ä¸ªé¡ºåºæ¥ä¾æ¬¡å¯åŠ¨å®¹å™¨ã€‚

```yaml
     eureka:
          build:
               context: ./eureka-boot
          restart: always
          ports:
               - 8761:8761
          container_name: eureka-boot
          hostname: eureka-boot
          image: eureka:1.0
          depends_on:
               - mysql
          networks:
               net:
```

---

### 2.2 æ–‡ä»¶æŒ‚è½½

åœ¨ Docker Compose é‡Œå®šä¹‰æ–‡ä»¶æŒ‚è½½çš„æ–¹å¼ä¸ Docker Engine é‡Œä¹Ÿå¹¶æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œä½¿ç”¨ `volumes` é…ç½®å¯ä»¥åƒ docker CLI é‡Œçš„ `-v` é€‰é¡¹ä¸€æ ·æ¥æŒ‡å®šå¤–éƒ¨æŒ‚è½½å’Œæ•°æ®å·æŒ‚è½½ã€‚

æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ•°æ®å·çš„å½¢å¼æŒ‚è½½å†…å®¹ã€‚åœ¨ä½¿ç”¨å¤–éƒ¨æ–‡ä»¶æŒ‚è½½çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®šç›¸å¯¹ç›®å½•è¿›è¡ŒæŒ‚è½½ï¼Œè¿™é‡Œçš„ç›¸å¯¹ç›®å½•æ˜¯æŒ‡ç›¸å¯¹äº `docker-compose.yml` æ–‡ä»¶çš„ç›®å½•ã€‚

ç”±äºæœ‰ç›¸å¯¹ç›®å½•è¿™æ ·çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å°† `docker-compose.yml` å’Œæ‰€æœ‰ç›¸å…³çš„æŒ‚è½½æ–‡ä»¶æ”¾ç½®åˆ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æ–‡ä»¶å¤¹ã€‚è¿™æ ·æ—¢å¯ä»¥å¾ˆå¥½çš„æ•´ç†é¡¹ç›®æ–‡ä»¶ï¼Œä¹Ÿåˆ©äºå®Œæ•´çš„è¿›è¡Œé¡¹ç›®è¿ç§»ã€‚

è™½ç„¶ Docker æå€¡å°†ä»£ç æˆ–ç¼–è¯‘å¥½çš„ç¨‹åºé€šè¿‡æ„å»ºé•œåƒçš„æ–¹å¼æ‰“åŒ…åˆ°é•œåƒé‡Œï¼Œéšæ•´ä¸ª CI æµéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸­ï¼Œä½†å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæ¯æ¬¡ä¿®æ”¹ç¨‹åºè¿›è¡Œç®€å•æµ‹è¯•éƒ½è¦é‡æ–°æ„å»ºé•œåƒç®€ç›´æ˜¯æµªè´¹ç”Ÿå‘½çš„æ“ä½œã€‚æ‰€ä»¥åœ¨å¼€å‘æ—¶ï¼Œæˆ‘ä»¬æ¨èç›´æ¥å°†ä»£ç æŒ‚è½½åˆ°å®¹å™¨é‡Œï¼Œè€Œä¸æ˜¯é€šè¿‡é•œåƒæ„å»ºçš„æ–¹å¼æ‰“åŒ…æˆé•œåƒã€‚

åŒæ—¶ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºç¨‹åºçš„é…ç½®ç­‰å†…å®¹ï¼Œæˆ‘ä»¬ä¹Ÿå»ºè®®ç›´æ¥ä½¿ç”¨æ–‡ä»¶æŒ‚è½½çš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨é‡Œï¼Œé¿å…ç»å¸¸ä¿®æ”¹æ‰€å¸¦æ¥çš„éº»çƒ¦ã€‚

---

#### 1)ä½¿ç”¨æ•°æ®å·

å¦‚æœæˆ‘ä»¬è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ•°æ®å·æ¥å­˜æ”¾ç‰¹æ®Šçš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®© Docker Compose è‡ªåŠ¨å®Œæˆå¯¹æ•°æ®å·çš„åˆ›å»ºï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬å•ç‹¬è¿›è¡Œæ“ä½œã€‚

ç‹¬ç«‹äº `services` çš„ `volumes` é…ç½®å°±æ˜¯ç”¨æ¥å£°æ˜æ•°æ®å·çš„ã€‚å®šä¹‰æ•°æ®å·æœ€ç®€å•çš„æ–¹å¼ä»…éœ€è¦æä¾›æ•°æ®å·çš„åç§°ï¼Œå¯¹äºæˆ‘ä»¬åœ¨ Docker Engine ä¸­åˆ›å»ºæ•°æ®å·æ—¶èƒ½å¤Ÿä½¿ç”¨çš„å…¶ä»–å®šä¹‰ï¼Œä¹Ÿèƒ½å¤Ÿæ”¾å…¥ Docker Compose çš„æ•°æ®å·å®šä¹‰ä¸­ã€‚

å¦‚æœæˆ‘ä»¬æƒ³æŠŠå±äº Docker Compose é¡¹ç›®ä»¥å¤–çš„æ•°æ®å·å¼•å…¥è¿›æ¥ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®å·å®šä¹‰ä¸ºå¤–éƒ¨å¼•å…¥ï¼Œé€šè¿‡ `external` è¿™ä¸ªé…ç½®å°±èƒ½å®Œæˆè¿™ä¸ªå®šä¹‰ã€‚

```yaml
## ......
volumes:
  mysql-data:
    external: true
## ......
```

åœ¨åŠ å…¥ `external` å®šä¹‰åï¼ŒDocker Compose åœ¨åˆ›å»ºé¡¹ç›®æ—¶ä¸ä¼šç›´æ¥åˆ›å»ºæ•°æ®å·ï¼Œè€Œæ˜¯ä¼˜å…ˆä» Docker Engine ä¸­å·²æœ‰çš„æ•°æ®å·é‡Œå¯»æ‰¾å¹¶ç›´æ¥é‡‡ç”¨ã€‚

---

### 2.3 é…ç½®ç½‘ç»œ

åœ¨ Docker Compose é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ•´ä¸ªåº”ç”¨ç³»ç»Ÿè®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œã€‚è¦ä½¿ç”¨ç½‘ç»œï¼Œæˆ‘ä»¬å¿…é¡»å…ˆå£°æ˜ç½‘ç»œã€‚å£°æ˜ç½‘ç»œçš„é…ç½®åŒæ ·ç‹¬ç«‹äº `services` å­˜åœ¨ï¼Œæ˜¯ä½äºæ ¹é…ç½®ä¸‹çš„ `networks` é…ç½®ã€‚

é™¤äº†ç®€å•çš„å£°æ˜ç½‘ç»œåç§°ï¼Œè®© Docker Compose è‡ªåŠ¨æŒ‰é»˜è®¤å½¢å¼å®Œæˆç½‘ç»œé…ç½®å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ˜¾å¼çš„æŒ‡å®šç½‘ç»œçš„å‚æ•°ã€‚

```yaml
networks:
  dev-env-net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.10.1.0/24
## ......
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºç½‘ç»œå®šä¹‰äº†ç½‘ç»œé©±åŠ¨çš„ç±»å‹ï¼Œå¹¶æŒ‡å®šäº†å­ç½‘çš„ç½‘æ®µã€‚

---

ç›´æ¥ä½¿ç”¨å®¹å™¨åæˆ–æœåŠ¡åæ¥ä½œä¸ºè¿æ¥å…¶ä»–æœåŠ¡çš„ç½‘ç»œåœ°å€ï¼Œå› ä¸ºç¼ºä¹çµæ´»æ€§ï¼Œå¸¸å¸¸è¿˜ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä¸ºæœåŠ¡å•ç‹¬è®¾ç½®ç½‘ç»œåˆ«åï¼Œåœ¨å…¶ä»–å®¹å™¨é‡Œï¼Œæˆ‘ä»¬å°†è¿™ä¸ªåˆ«åä½œä¸ºç½‘ç»œåœ°å€è¿›è¡Œè®¿é—®ã€‚ç½‘ç»œåˆ«åçš„å®šä¹‰æ–¹å¼å¾ˆç®€å•ï¼Œè¿™é‡Œéœ€è¦å°†ä¹‹å‰ç®€å•çš„ç½‘ç»œ List å®šä¹‰ç»“æ„ä¿®æ”¹æˆ Map ç»“æ„ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸­åŠ å…¥æ›´å¤šçš„å®šä¹‰ã€‚

```yaml
## ......
  database:
    networks:
      backend:
        aliases:
          - backend.database
## ......
  eureka:
    networks:
      backend:
        aliases:
          - backend.eureka
      frontend:
        aliases:
          - frontend.eureka
## ......
```

åœ¨æˆ‘ä»¬è¿›è¡Œè¿™æ ·çš„é…ç½®åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨è¿™é‡Œæˆ‘ä»¬æ‰€è®¾ç½®çš„ç½‘ç»œåˆ«åå¯¹å…¶ä»–å®¹å™¨è¿›è¡Œè®¿é—®äº†ã€‚

---

åœ¨ Docker Compose çš„æ¯ä¸ªæœåŠ¡é…ç½®é‡Œï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº† `ports` è¿™ä¸ªé…ç½®é¡¹ï¼Œå®ƒæ˜¯ç”¨æ¥å®šä¹‰ç«¯å£æ˜ å°„çš„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œå®¿ä¸»æœºä¸å®¹å™¨ç«¯å£çš„æ˜ å°„ï¼Œè¿™ä¸ªé…ç½®ä¸ docker CLI ä¸­ `-p` é€‰é¡¹çš„ä½¿ç”¨æ–¹æ³•æ˜¯è¿‘ä¼¼çš„ã€‚

> ç”±äº YAML æ ¼å¼å¯¹ `xx:yy` è¿™ç§æ ¼å¼çš„è§£ææœ‰ç‰¹æ®Šæ€§ï¼Œåœ¨è®¾ç½®å°äº 60 çš„å€¼æ—¶ï¼Œä¼šè¢«å½“æˆæ—¶é—´è€Œä¸æ˜¯å­—ç¬¦ä¸²æ¥å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½ä½¿ç”¨å¼•å·å°†ç«¯å£æ˜ å°„çš„å®šä¹‰åŒ…è£¹èµ·æ¥ï¼Œé¿å…æ­§ä¹‰ã€‚

---

## 3.Docker Compose æœ€ä½³å®è·µ

### 3.1 æ­å»ºELK

```yaml
version: "3"
services:
  my-elasticsearch:
    environment:
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - "discovery.type=single-node"
    restart: always
    container_name: my-elasticsearch
    image: "elasticsearch:7.16.2"
    ports:
        - 9200:9200
        - 9300:9300
    networks:
      - dev-env-net
  my-kibana:
    restart: always
    container_name: my-kibana
    image: "kibana:7.16.2"
    volumes:
       - /Users/HuidongYin/elk/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml
    ports:
        - "5601:5601"
    networks:
      - dev-env-net
    depends_on:
      - my-elasticsearch
networks:
  dev-env-net:
    driver: bridge

```

---

### 3.2 æ­å»ºZookeeperé›†ç¾¤

1. ç›®å½•ç»“æ„

```plaintext
ğŸ‘¨ HuidongYin ğŸ“Œ  ~/zk-cluster âŒš 24-01-11 14:43:20
$ tree ./              
./
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ zookeeper1
â”‚         â”œâ”€â”€ conf
â”‚         â”‚         â””â”€â”€ zoo.cfg
â”‚         â”œâ”€â”€ data
â”‚         â”‚         â”œâ”€â”€ myid
â”‚         â”‚         â””â”€â”€ version-2
â”‚         â”‚             â”œâ”€â”€ acceptedEpoch
â”‚         â”‚             â”œâ”€â”€ currentEpoch
â”‚         â”‚             â””â”€â”€ snapshot.0
â”‚         â””â”€â”€ logs
â”‚             â””â”€â”€ version-2
â”‚                 â”œâ”€â”€ log.100000001
â”‚                 â””â”€â”€ log.200000001
â”œâ”€â”€ zookeeper2
â”‚         â”œâ”€â”€ conf
â”‚         â”‚         â””â”€â”€ zoo.cfg
â”‚         â”œâ”€â”€ data
â”‚         â”‚         â”œâ”€â”€ myid
â”‚         â”‚         â””â”€â”€ version-2
â”‚         â”‚             â”œâ”€â”€ acceptedEpoch
â”‚         â”‚             â”œâ”€â”€ currentEpoch
â”‚         â”‚             â””â”€â”€ snapshot.0
â”‚         â””â”€â”€ logs
â”‚             â””â”€â”€ version-2
â”‚                 â”œâ”€â”€ log.100000001
â”‚                 â””â”€â”€ log.200000001
â””â”€â”€ zookeeper3
    â”œâ”€â”€ conf
    â”‚         â””â”€â”€ zoo.cfg
    â”œâ”€â”€ data
    â”‚         â”œâ”€â”€ myid
    â”‚         â””â”€â”€ version-2
    â”‚             â”œâ”€â”€ acceptedEpoch
    â”‚             â”œâ”€â”€ currentEpoch
    â”‚             â”œâ”€â”€ snapshot.0
    â”‚             â””â”€â”€ snapshot.100000001
    â””â”€â”€ logs
        â””â”€â”€ version-2
            â”œâ”€â”€ log.100000001
            â””â”€â”€ log.200000001

19 directories, 23 files
ğŸ‘¨ HuidongYin ğŸ“Œ  ~/zk-cluster âŒš 24-01-11 14:43:45
```

ä»ä¸Šé¢çš„ç›®å½•ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œæˆ‘ä»¬ä»…ä»…éœ€è¦å†æ¯ä¸€ä¸ª `conf` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `zoo.cfg` æ–‡ä»¶ã€‚å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š

```plaintext
tickTime=2000
initLimit=5
syncLimit=2
dataDir=/data
dataLogDir=/datalog
autopurge.snapRetainCount=3
autopurge.purgeInterval=0
maxClientCnxns=60
admin.enableServer=true
4lw.commands.whitelist=conf,stat
server.1=zookeeper1:2888:3888;2181
server.2=zookeeper2:2888:3888;2181
server.3=zookeeper3:2888:3888;2181
```

å…³äº `data` ç›®å½•ä¸‹çš„ `myid` æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä¼šåœ¨ `docker-compose.yml` é‡Œé¢æŒ‡å®šè¯¥å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä¸éœ€è¦åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœéœ€è¦åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œä»…ä»…åœ¨é‡Œé¢å†™æ•°å­—å³å¯ã€‚

```yaml
version: '3'
services:
  zookeeper1:
    image: zookeeper:3.7.1
    volumes:
      - /Users/HuidongYin/zk-cluster/zookeeper1/conf:/conf
      - /Users/HuidongYin/zk-cluster/zookeeper1/data:/data
      - /Users/HuidongYin/zk-cluster/zookeeper1/logs:/datalog
    restart: always
    container_name: zookeeper1
    ports:
      - "2181:2181"
    environment:
      ZOO_MY_ID: 1
    networks:
      - zookeeper-net

  zookeeper2:
    image: zookeeper:3.7.1
    volumes:
      - /Users/HuidongYin/zk-cluster/zookeeper2/conf:/conf
      - /Users/HuidongYin/zk-cluster/zookeeper2/data:/data
      - /Users/HuidongYin/zk-cluster/zookeeper2/logs:/datalog
    restart: always
    container_name: zookeeper2
    ports:
      - "2182:2181"
    environment:
      ZOO_MY_ID: 2
    networks:
      - zookeeper-net

  zookeeper3:
    image: zookeeper:3.7.1
    volumes:
      - /Users/HuidongYin/zk-cluster/zookeeper3/conf:/conf
      - /Users/HuidongYin/zk-cluster/zookeeper3/data:/data
      - /Users/HuidongYin/zk-cluster/zookeeper3/logs:/datalog
    restart: always
    container_name: zookeeper3
    ports:
      - "2183:2181"
    environment:
      ZOO_MY_ID: 3
    networks:
      - zookeeper-net
## å¦‚æœå•å•æ˜¯Zookeeperé›†ç¾¤å¯ä»¥ä½¿ç”¨è¿™ä¸ªç½‘ç»œ
networks:
  zookeeper-net:
    driver: bridge
## å¦‚æœæ˜¯å’Œå¦ä¸€ä¸ªdocker compose çš„ kafka é›†ç¾¤è¿æ¥ ï¼Œä½¿ç”¨æ­¤ç§æ–¹å¼
#  docker network create zk-net
# networks:
#  zookeeper-net:
#    name: zk-net
#    external: true
```

---

### 3.3 æ­å»ºKafkaé›†ç¾¤

è¿™é‡Œæˆ‘ä»¬è¦åœ¨ `docker-compose.yml`é‡Œé¢å¼•ç”¨å½“å‰ä¸»æœºçš„IPï¼Œæˆ‘ä»¬å¯ä»¥å°†å½“å‰ä¸»æœºçš„IPé…ç½®åœ¨ `.env`æ–‡ä»¶ï¼Œç„¶ååœ¨ `docker-compose.yml` æ–‡ä»¶é‡Œé¢å¼•ç”¨ã€‚

```yaml
LOCAL_IP=å®¿ä¸»æœºIP
```

```yaml
version: "3"

services:
  kafka-1:
    image: wurstmeister/kafka
    container_name: kafka-1
    restart: always
    ports:
      - "9092:9092"
    environment:
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://${LOCAL_IP}:9092
      ALLOW_PLAINTEXT_LISTENER: yes
      KAFKA_ZOOKEEPER_CONNECT: "zookeeper1:2181,zookeeper2:2181,zookeeper3:2181/kafka-cluster"
      KAFKA_BROKER_ID: 1
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    networks:
      - zookeeper-net

  kafka-2:
    image: wurstmeister/kafka
    container_name: kafka-2
    restart: always
    ports:
      - "9093:9092"
    environment:
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://${LOCAL_IP}:9093
      ALLOW_PLAINTEXT_LISTENER: yes
      KAFKA_ZOOKEEPER_CONNECT: "zookeeper1:2181,zookeeper2:2181,zookeeper3:2181/kafka-cluster"
      KAFKA_BROKER_ID: 2
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    networks:
      - zookeeper-net

  kafka-3:
    image: wurstmeister/kafka
    container_name: kafka-3
    restart: always
    ports:
      - "9094:9092"
    environment:
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://${LOCAL_IP}:9094
      ALLOW_PLAINTEXT_LISTENER: yes
      KAFKA_ZOOKEEPER_CONNECT: "zookeeper1:2181,zookeeper2:2181,zookeeper3:2181/kafka-cluster"
      KAFKA_BROKER_ID: 3
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    networks:
      - zookeeper-net

networks:
  zookeeper-net:
    name: zk-net
    external: true
```

ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```yaml
ğŸ‘¨ HuidongYin ğŸ“Œ  ~/kafka-cluster âŒš 24-01-11 16:58:05
$ tree ./ -al
./
â”œâ”€â”€ .env
â””â”€â”€ docker-compose.yml

1 directory, 2 files
ğŸ‘¨ HuidongYin ğŸ“Œ  ~/kafka-cluster âŒš 24-01-11 16:58:10
```

---

### 3.4 æ­å»ºMySQL&Redis

ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```plaintext
ğŸ‘¨ HuidongYin ğŸ“Œ  ~/mysql_redis âŒš 24-01-11 17:36:25
$ tree ./    
./
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ mysql
â”‚         â””â”€â”€ my.cnf
â””â”€â”€ redis
    â”œâ”€â”€ data
    â”‚         â”œâ”€â”€ dump.rdb
    â”‚         â””â”€â”€ redis.log
    â””â”€â”€ redis.conf

4 directories, 5 files
ğŸ‘¨ HuidongYin ğŸ“Œ  ~/mysql_redis âŒš 24-01-11 17:36:35
```

`docker-compose.yml`å†…å®¹å¦‚ä¸‹ï¼š

```yaml
version: '3'
services:
  mysql:
    image: mysql/mysql-server:5.7
    volumes:
      - /Users/HuidongYin/mysql_redis/mysql/my.cnf:/etc/my.cnf
    restart: always
    container_name: mysql
    ports:
      - "3306:3306"
    environment:
      - "MYSQL_ROOT_PASSWORD=root"
    networks:
      - mysql-redis-net
  redis:
    image: redis:6
    command: redis-server /etc/redis/redis.conf  --appendonly no
    volumes:
      - /Users/HuidongYin/mysql_redis/redis/redis.conf:/etc/redis/redis.conf
      - /Users/HuidongYin/mysql_redis/redis/data:/data
    restart: always
    container_name: redis
    ports:
      - "6379:6379"
    networks:
      - mysql-redis-net

networks:
  mysql-redis-net:
    driver: bridge
```

`redis.conf`é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

```plaintext
# è®°å¾—æŠŠè¿™ä¸ªé…ç½®å±è”½æ‰ï¼Œå¦åˆ™ä½ ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´
# bind 127.0.0.1

protected-mode no
port 6379
tcp-backlog 511
timeout 0

tcp-keepalive 300

# å¦‚æœå‘½ä»¤è¡Œä½¿ç”¨äº†-d è¿™ä¸ªåœ°æ–¹å¿…é¡»è®¾ç½®ä¸ºnoï¼Œå¦åˆ™å®¹å™¨æ— æ³•å¯åŠ¨
daemonize no
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice

# è¿™ä¸ªç›®å½•ä¹Ÿä¼šé’ˆå¯¹æœ¬æœºåšä¸€ä¸ªæ˜ å°„
logfile "/data/redis.log"


databases 16
always-show-logo yes
```

`my.cnf`é…ç½®å¦‚ä¸‹ï¼š

```plaintext
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M
skip-host-cache
skip-name-resolve
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
secure-file-priv=/var/lib/mysql-files
user=mysql

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

#log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

[client]
default_character_set=utf8
[mysqld]
collation_server = utf8_general_ci
character_set_server = utf8
```

---
